{"ast":null,"code":"import _defineProperty from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _createForOfIteratorHelper from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _slicedToArray from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _assertThisInitialized from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";import _inherits from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import GoogleMapReact from'google-map-react';import{getNearby,getPages,getPhoto}from'../../Requests/map-requests';import'../../css/App.scss';import{connect}from'react-redux';import{createSelector}from'reselect';import{updatePlaces}from'../../Actions/places-actions';import{updateActivePlace}from'../../Actions/active-actions';import ReactDOMServer from'react-dom/server';import DemographicsPanel from'./Panels/DemographicsPanel';import{updateTract}from'../../Actions/tract-actions';import Form from'react-bootstrap/Form';import{getPoints}from'../../Helpers/TradeZone';import{ZIP,TRADE_ZONE}from'./Panels/DemographicsPanel';import{GOOGLE_KEY,google,BUSINESS_TYPES,POI_TYPES}from'../../Constants.js';import{renderCircle,renderMarker,renderComplexMarker,renderLargeMarker,renderInfoContent,BLUE_MARKER,YELLOW_MARKER,GREEN_MARKER,RED_MARKER,BLUE_DOT_05,YELLOW_DOT_25,YELLOW_DOT_3,BLUE_DOT_5}from'./GoogleMaps/GoogleMapComponents';import{activeSelector,addressSelector,businessTypeSelector,dataRangeSelector,placesSelector,stateSelector,tractSelector,zipSelector,isCitySelector,tradeZoneBoundsSelector,transportationSelector,geoUnitSelector,statsSelector}from'../../Reducers/selectors';import SliderSwitch from'../UI/SliderSwitch';import Button from'react-bootstrap/Button';import{updateTradeZoneBounds}from'../../Actions/tradeZoneBoundaries-actions';import ReactStreetview from'react-streetview';import{updateTransportation}from'../../Actions/transportation-actions';import{createTradeZoneCartography}from'../../Requests/locations-requests';import FadeLoader from'../UI/FadeLoader';import{getSubwayTotals}from'../../Requests/subway-requests';import{getListingByPlaceId}from\"../../Requests/listings-requests\";import{withRouter}from'react-router-dom';import MediaQuery from'react-responsive';import Toolbar from'../Mobile/Toolbar';import PlacesList from'./Panels/PlacesList';import ChartsPanel from'./Panels/ChartsPanel';// import CommentsPanel from './Panels/CommentsPanel'\nimport TransportationPanel from'./Panels/TransportationPanel';import{getCounty}from'../utils/distance';import{Boroughs}from'../utils/zipcodes';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var infoWindow=new google.maps.InfoWindow();var SimpleMap=/*#__PURE__*/function(_Component){_inherits(SimpleMap,_Component);var _super=_createSuper(SimpleMap);function SimpleMap(props){var _loadingCart;var _this;_classCallCheck(this,SimpleMap);_this=_super.call(this,props);_this.loadListing=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getListingByPlaceId(_this.props.address.place.place_id);case 2:res=_context.sent;if(!(res===undefined)){_context.next=5;break;}return _context.abrupt(\"return\");case 5:if(res.length>0){_this.setState({hasListing:true,listing:res[0]});}case 6:case\"end\":return _context.stop();}}},_callee);}));_this.updatePlacesFromRedux=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(type,display_value,index){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(type=='hotels_/lodging')type='lodging';else if(type=='all')type='establishment';if(!(type=='none')){_context2.next=5;break;}_this.setState({places_count:0,poi:display_value,business_type:type,business_type_option:'none'},function(){return _this.onUpdatePlaces([]);});_context2.next=9;break;case 5:_this.setState({places_count:index+1,poi:display_value,business_type:type,business_type_option:'none'});_this.clearMarkers();_context2.next=9;return _this.loadPlaceType(type,index);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();_this.clearMarkers=function(){// clear markers \nvar updatedMarkers=new Map();_this.state.markers.forEach(function(e,i){e.marker.setMap(null);if(i<_this.props.places.length)updatedMarkers.set(e.place_id,e);});_this.setState({markers:updatedMarkers});};_this.onHandleCenter=function(){_this.setState({center:_this.props.center});if(_this.state.siteView)_this.setState({siteView:false});};_this.updateMarkers=function(map,markers_to_keep){var markerMap=_this.state.markers;Array.from(_this.props.places).map(function(place,i){var id=place.place_id;var img='';var marker;// filter preexisting places\nif(!markers_to_keep.has(id)){if(_this.props.business_type.type!='residential'&&_this.props.business_type.type==_this.state.business_type){img=RED_MARKER;}else{img=YELLOW_MARKER;}marker=renderMarker(i,place.geometry.location,map,place.name,img);markerMap.set(id,{marker:marker,place:place});}});_this.setState({markers:markerMap});_this.updateInfoWindow(map);};_this.updateInfoWindow=function(map){return Array.from(_this.state.markers,function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],value=_ref4[1];// to close window on exit\nvalue.marker.addListener('click',function(){_this.onUpdateActivePlace(value.place);_this.updatePlaceDetails(function(){infoWindow.setContent(ReactDOMServer.renderToStaticMarkup(_this.getInfoContent(value.place)));infoWindow.marker=value;infoWindow.open(map,value.marker);});});});};_this.getPlaceDetails=function(map,place_id,callback){var service=new google.maps.places.PlacesService(map);var request={placeId:place_id,fields:['id','name','icon','formatted_address','website']};// get details\nservice.getDetails(request,function(place,status){if(status===google.maps.places.PlacesServiceStatus.OK){callback(place);}else{console.error('error',status);}});};_this.getOpen=function(opening_hours){if(opening_hours===undefined)return'Unknown';else{var answer=opening_hours.is_open?\"Yes\":\"No\";return answer;}};_this.updateMarker=function(marker){if(marker==undefined)return;var img='';if(marker.place.place_id==_this.props.address.place.place_id){img=BLUE_MARKER;}else if(marker.place_id===_this.props.active_place.place_id){img=GREEN_MARKER;}else if(_this.props.business_type.type!='residential'&&_this.props.business_type.type==_this.state.business_type){img=RED_MARKER;}else{img=YELLOW_MARKER;}marker.marker.setIcon(img);};_this.handleSwitch=function(checked){if(checked){_this.renderCartography();}else{_this.clearCartography();}};_this.onHandleSite=function(checked){if(checked){_this.setState({siteView:true});}else{_this.setState({siteView:false});}};_this.handleChange=function(event){_this.setState({center:event.center});};_this.onUpdateTransportation=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(transportation){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this.props.onUpdateTransportation(transportation);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4){return _ref5.apply(this,arguments);};}();_this.loadNearbySubways=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var type;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:type='subway_station';getNearby(_this.props.address,type,/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(data,token){var _iterator,_step,place,subwayCoords,subway_data,transportObj,subwayMap,i;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// cache loaded places\n_iterator=_createForOfIteratorHelper(data);try{for(_iterator.s();!(_step=_iterator.n()).done;){place=_step.value;if(!_this.state.places_cache.get(type).has(place.place_id)){_this.state.places_cache.get(type).set(place.place_id,place);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}_this.state.tokens_cache.set(type,token);subwayCoords=[];Array.from(_this.state.places_cache.get(type).entries()).map(function(_ref8,i){var _ref9=_slicedToArray(_ref8,2),key=_ref9[0],value=_ref9[1];if(i>4)return;subwayCoords.push(value.geometry.location);});_context4.next=7;return getSubwayTotals(subwayCoords);case 7:subway_data=_context4.sent;// Calculate distance //////\nsubway_data.forEach(function(e){var dist=distance(_this.props.address.coords.lat,_this.props.address.coords.lng,e.data.G_LAT,e.data.G_LNG);e.distance=dist;});subway_data.sort(function(x,y){if(x.distance<y.distance){return-1;}if(x.distance>y.distance){return 1;}return 0;});transportObj=JSON.parse(JSON.stringify(_this.props.transportation));if(transportObj==''){transportObj={};}// clean up subway data\nsubwayMap=new Map();for(i=0;i<subway_data.length;i++){if(!subwayMap.has(subway_data[i].name)){subwayMap.set(subway_data[i].name,subway_data[i].data);}else{// check if values are equal, if so arggregate to one location\nif(subwayMap.get(subway_data[i].name).G_TOTAL_ENT==subway_data[i].data.G_TOTAL_ENT){subwayMap.set(subway_data[i].name,_objectSpread(_objectSpread({},subwayMap.get(subway_data[i].name)),{},{G_LINES:subwayMap.get(subway_data[i].name).G_LINES+'-'+subway_data[i].data.G_LINES}));}}}transportObj.subways=subwayMap;_context4.next=17;return _this.onUpdateTransportation(transportObj);case 17:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x5,_x6){return _ref7.apply(this,arguments);};}());case 2:case\"end\":return _context5.stop();}}},_callee5);}));_this.generateHeading=function(){var sv=new google.maps.StreetViewService();// initialize a new panorama API object and point to the element with ID streetview as container\nvar panorama=new google.maps.StreetViewPanorama(document.getElementById('pano'),{position:_this.props.center});sv.getPanorama({location:_this.props.center,radius:50},function(data,status){if(status===google.maps.StreetViewStatus.OK){var marker_pano=new google.maps.Marker({position:_this.props.center,map:panorama});var heading=google.maps.geometry.spherical.computeHeading(data.location.latLng,marker_pano.getPosition());panorama.setPov({heading:heading,pitch:0});_this.setState({heading:heading});}});};_this.navigateToListing=function(){var url='/listing/'+_this.state.listing.listingId;_this.props.history.push(url);};_this.openToolBar=function(){_this.setState({toolsOpen:!_this.state.toolsOpen});};_this.myRef=/*#__PURE__*/React.createRef();_this.streetView=/*#__PURE__*/React.createRef();_this.service=new google.maps.StreetViewService();// let defaultPlace = this.props.business_type.type\n// let type = this.props.business_type.type\n// let business_option = type.replace(/_/g, ' ')\n// if (type == 'lodging') type = 'hotels /lodging'\n// else if (defaultPlace == 'residential') {\n//   defaultPlace = 'establishment'\n//   business_option = 'all'\n// }\n_this.state={center:_this.props.center,map:undefined,markers:new Map(),place_details:new Map(),place_photos:new Map(),places_cache:new Map(),tokens_cache:new Map(),places_count:20,address_line:_this.props.address.street+', '+_this.props.address.city+' '+_this.props.address.state+', '+_this.props.address.zip,boundaries:getPoints(_this.props.center,0.804,1),cartography:{},display_cartography:true,business_type:'',//defaultPlace,\ncartographyLoaded:false,poi:'none',business_type_option:'',//business_option,\naerial:true,zoom:_this.props.zoom,siteView:false,mapType:google.maps.MapTypeId.SATELLITE,loadingCart:(_loadingCart={},_defineProperty(_loadingCart,ZIP,true),_defineProperty(_loadingCart,TRADE_ZONE,true),_loadingCart),mapOptions:{streetViewControl:true,scaleControl:true,fullscreenControl:false,styles:[{featureType:\"poi.business\",elementType:\"labels\",stylers:[{visibility:\"off\"}]}],gestureHandling:\"greedy\",disableDoubleClickZoom:true,minZoom:5,maxZoom:100,mapTypeControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]},zoomControl:true,clickableIcons:false},toolsOpen:false};_this.onUpdatePlaces=_this.onUpdatePlaces.bind(_assertThisInitialized(_this));_this.onUpdateActivePlace=_this.onUpdateActivePlace.bind(_assertThisInitialized(_this));_this.onUpdateTract=_this.onUpdateTract.bind(_assertThisInitialized(_this));_this.lessPlaces=_this.lessPlaces.bind(_assertThisInitialized(_this));_this.loadAllPlaces=_this.loadAllPlaces.bind(_assertThisInitialized(_this));_this.loadMorePlaces=_this.loadMorePlaces.bind(_assertThisInitialized(_this));_this.loadDefaultPlaces=_this.loadDefaultPlaces.bind(_assertThisInitialized(_this));_this.exampleRef=/*#__PURE__*/React.createRef();_this.updateMarkers=_this.updateMarkers.bind(_assertThisInitialized(_this));_this.updateMarker=_this.updateMarker.bind(_assertThisInitialized(_this));_this.updateInfoWindow=_this.updateInfoWindow.bind(_assertThisInitialized(_this));_this.getopen=_this.getOpen.bind(_assertThisInitialized(_this));_this.getPlaceDetails=_this.getPlaceDetails.bind(_assertThisInitialized(_this));_this.updatePlaceDetails=_this.updatePlaceDetails.bind(_assertThisInitialized(_this));_this.onBusinessFormChange=_this.onBusinessFormChange.bind(_assertThisInitialized(_this));_this.loadZipCartography=_this.loadZipCartography.bind(_assertThisInitialized(_this));_this.renderCartography=_this.renderCartography.bind(_assertThisInitialized(_this));_this.getInfoContent=_this.getInfoContent.bind(_assertThisInitialized(_this));_this.handleSwitch=_this.handleSwitch.bind(_assertThisInitialized(_this));_this.clearCartography=_this.clearCartography.bind(_assertThisInitialized(_this));_this.onPlacesCountChange=_this.onPlacesCountChange.bind(_assertThisInitialized(_this));_this.updateRadii=_this.updateRadii.bind(_assertThisInitialized(_this));_this.initCache=_this.initCache.bind(_assertThisInitialized(_this));_this.onUpdateTradeZoneBounds=_this.onUpdateTradeZoneBounds.bind(_assertThisInitialized(_this));_this.loadTradeZoneCartography=_this.loadTradeZoneCartography.bind(_assertThisInitialized(_this));_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.onPoiFormChange=_this.onPoiFormChange.bind(_assertThisInitialized(_this));// to-do create function updateInfoWindow\nsetInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(){var isBound,img;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:isBound=infoWindow.getMap()?true:false;if(!isBound&&infoWindow.marker!=undefined&&infoWindow.marker.key!='your_business'){img='';if(infoWindow.marker.place.place_id==_this.props.address.place.place_id){img=BLUE_MARKER;}else if(_this.props.business_type.type!='residential'&&infoWindow.marker.place.types.includes(_this.props.business_type.type)){img=RED_MARKER;}else{img=YELLOW_MARKER;}infoWindow.marker.marker.setIcon(img);_this.onUpdateActivePlace(false);}case 2:case\"end\":return _context6.stop();}}},_callee6);})),500);return _this;}_createClass(SimpleMap,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:window.scrollTo({top:0,behavior:'smooth'});this.initCache();_context7.next=4;return this.loadListing();case 4:// first time user check\nif(this.props.isFirstTimeUser){this.props.updateIsFirstTime(false);if(window.innerWidth>550){this.props.runJoyRideTutorial();}}case 5:case\"end\":return _context7.stop();}}},_callee7,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.onUpdatePlaces([]);}},{key:\"componentDidUpdate\",value:function(){var _componentDidUpdate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(prevProps,prevState){var all_markers,markers_to_delete,markers_to_keep,arr,defaultPlace,type,business_option;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:// active place change\nif(this.props.active_place&&this.props.active_place!==prevProps.active_place)if(this.props.active_place.toString().length>0){this.setState({center:this.props.active_place.geometry.location});// highlight marker on map\nif(prevProps.active_place.toString().length>0){this.updateMarker(this.state.markers.get(prevProps.active_place.place_id));}this.state.markers.get(this.props.active_place.place_id).marker.setIcon(GREEN_MARKER);google.maps.event.trigger(this.state.markers.get(this.props.active_place.place_id).marker,'click');}// update markers \nif(this.props.places!==prevProps.places&&!(!this.state.siteView&&prevState.siteView)){if(this.state.map!=undefined){all_markers=Array.from(this.state.markers.values());markers_to_delete=[];markers_to_keep=new Map();if(prevProps.places.length>this.props.places.length){markers_to_delete=all_markers.slice(this.props.places.length,prevProps.places.length);all_markers.slice(0,this.props.length).forEach(function(m){return markers_to_keep.set(m.place_id,0);});// set placeholder, actual value not needed\n}else if(prevProps.places.length<this.props.places.length){arr=all_markers.slice(0,prevProps.places.length);arr.forEach(function(m){return markers_to_keep.set(m.place_id,0);});}else{this.clearMarkers();}// remove necesary markers\nmarkers_to_delete.forEach(function(m){return m.marker.setMap(null);});// update all markers ....\nthis.updateMarkers(this.state.map,markers_to_keep);}}// update geojson\nif(!(this.state.map!==undefined)){_context8.next=7;break;}if(!(this.props.data_range!==prevProps.data_range)){_context8.next=7;break;}if(!this.state.display_cartography){_context8.next=7;break;}_context8.next=7;return this.renderCartography();case 7:// reload subways on address change\nif(prevProps.address!=this.props.address){this.clearMarkers();this.loadListing();//    this.clearCartography()\n}// show subways on transportation change\nif(!(prevProps.transportation.showSubways!=this.props.transportation.showSubways)){_context8.next=12;break;}_context8.next=11;return this.loadNearbySubways();case 11:this.updatePlacesFromRedux('subway_station','subway station',4);case 12:// change business type from demo panel\nif(prevProps.business_type!=this.props.business_type){defaultPlace=this.props.business_type.type;type=this.props.business_type.type;business_option=type.replace(/_/g,' ');if(type=='lodging')type='hotels /lodging';else if(defaultPlace=='residential'){defaultPlace='establishment';business_option='all';}//  await this.setState({ business_type : type, business_type_option : business_option })\nthis.clearMarkers();this.updateMarkers(this.state.map,new Map());}// zip cart\nif(prevProps.stats.zip!==this.props.stats.zip){this.loadZipCartography();}//TZ cart\nif(prevProps.stats.tradezone!==this.props.stats.tradezone){this.loadTradeZoneCartography();}case 15:case\"end\":return _context8.stop();}}},_callee8,this);}));function componentDidUpdate(_x7,_x8){return _componentDidUpdate.apply(this,arguments);}return componentDidUpdate;}()},{key:\"onUpdateTradeZoneBounds\",value:function onUpdateTradeZoneBounds(tradeZone_bounds){this.props.onUpdateTradeZoneBounds(tradeZone_bounds);}},{key:\"loadZipCartography\",value:function(){var _loadZipCartography=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){var mCartography,data;return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(!(this.props.address.zip==undefined)){_context9.next=2;break;}return _context9.abrupt(\"return\");case 2:mCartography=Object.assign({},this.state.cartography);data=[this.props.stats.zip];mCartography.zip=data;this.setState({cartography:mCartography,loadingCart:_objectSpread(_objectSpread({},this.state.loadingCart),{},_defineProperty({},ZIP,false))});// init geojson rendering\nthis.renderCartography();case 7:case\"end\":return _context9.stop();}}},_callee9,this);}));function loadZipCartography(){return _loadZipCartography.apply(this,arguments);}return loadZipCartography;}()},{key:\"loadTradeZoneCartography\",value:function(){var _loadTradeZoneCartography=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var data,mCartography;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:// get new tz cart with bounds \ndata=this.props.stats.tradezone.collection;mCartography=Object.assign({},this.state.cartography);mCartography.tradezone=data;_context10.next=5;return this.setState({cartography:mCartography,cartographyLoaded:true,loadingCart:_objectSpread(_objectSpread({},this.state.loadingCart),{},_defineProperty({},TRADE_ZONE,false))});case 5:this.renderCartography();case 6:case\"end\":return _context10.stop();}}},_callee10,this);}));function loadTradeZoneCartography(){return _loadTradeZoneCartography.apply(this,arguments);}return loadTradeZoneCartography;}()},{key:\"initCache\",value:function initCache(){var _iterator2=_createForOfIteratorHelper(BUSINESS_TYPES.concat(POI_TYPES).concat(['establishment'])),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var type=_step2.value;if(type=='hotels /lodging')type='lodging';this.state.places_cache.set(type,new Map());}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}},{key:\"clearCartography\",value:function clearCartography(){var _this2=this;if(this.state.map)this.state.map.data.forEach(function(feature){_this2.state.map.data.remove(feature);});}},{key:\"renderCartography\",value:function renderCartography(){var _this3=this;// clear data layer \nthis.clearCartography();// render cartography\nif(this.props.data_range==ZIP){if(this.state.cartography.zip!==undefined&&this.state.map){this.state.cartography.zip.forEach(function(featureSet){return _this3.state.map.data.addGeoJson(featureSet);});}else{setTimeout(function(){return _this3.renderCartography();},100);}}else if(this.props.data_range==TRADE_ZONE){if(this.state.cartography.tradezone!==undefined&&this.state.map){this.state.cartography.tradezone.forEach(function(featureSet){return _this3.state.map.data.addGeoJson(featureSet);});}else{setTimeout(function(){return _this3.renderCartography();},100);}}}},{key:\"loadDefaultPlaces\",value:function(){var _loadDefaultPlaces=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(){var _this4=this;var place;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:if(!this.props.address.place.types.includes('establishment')){_context12.next=5;break;}// get and set place for address if applicable \nplace=this.props.address.place;_context12.next=4;return this.setState({addressPlace:place});case 4:this.getPlaceDetails(this.state.map,this.props.address.place.place_id,/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(details){return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:place.icon=details.icon;place.name=details.name;place.place_id=details.id;_this4.state.place_details.set(place.id,details);case 4:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x9){return _ref11.apply(this,arguments);};}());case 5:case\"end\":return _context12.stop();}}},_callee12,this);}));function loadDefaultPlaces(){return _loadDefaultPlaces.apply(this,arguments);}return loadDefaultPlaces;}()},{key:\"loadPlaceType\",value:function loadPlaceType(type,index){var _this5=this;var cached_places=Array.from(this.state.places_cache.get(type).values());if(cached_places.length==0){// if not cached load places\ngetNearby(this.props.address,type,function(data,token){//     var morePlaces = this.props.places.concat(data)\n_this5.setState({places:data});// cache loaded places\nvar _iterator3=_createForOfIteratorHelper(data),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var place=_step3.value;if(!_this5.state.places_cache.get(type).has(place.place_id)){_this5.state.places_cache.get(_this5.state.business_type).set(place.place_id,place);}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}_this5.state.tokens_cache.set(type,token);_this5.onUpdatePlaces(data);});// if already cached \n}else{if(index==undefined){this.setState({places:cached_places.slice(0,20)});this.onUpdatePlaces(cached_places.slice(0,20));}else{this.setState({places:cached_places.slice(0,index)});this.onUpdatePlaces(cached_places.slice(0,index));}}}},{key:\"loadAllPlaces\",value:function loadAllPlaces(){var _this6=this;getNearby(this.props.address,'establishment',function(data,token){var morePlaces=_this6.props.places.concat(data);_this6.setState({places:morePlaces});_this6.setState({places_count:20});_this6.state.tokens_cache.set('establishment',token);_this6.onUpdatePlaces(data);});}},{key:\"loadMorePlaces\",value:function loadMorePlaces(index,hasCallback,callback){var _this7=this;var cached_places=Array.from(this.state.places_cache.get(this.state.business_type).values());if(cached_places.length>index){var morePlaces=this.state.places.concat(cached_places.slice(index,index+20));this.setState({places:morePlaces},function(){_this7.onUpdatePlaces(morePlaces);if(hasCallback){callback();}});}else{getPages(this.state.tokens_cache.get(this.state.business_type),function(data,token){_this7.state.tokens_cache.set(_this7.state.business_type,token);var morePlaces=_this7.props.places.concat(data);var _iterator4=_createForOfIteratorHelper(morePlaces),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var place=_step4.value;if(!_this7.state.places_cache.get(_this7.state.business_type).has(place.place_id)){_this7.state.places_cache.get(_this7.state.business_type).set(place.place_id,place);}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}_this7.setState({places:morePlaces},function(){_this7.onUpdatePlaces(morePlaces);if(hasCallback){callback();}});});}}},{key:\"lessPlaces\",value:function lessPlaces(){if(this.props.places.length>20){var places=this.props.places;places=places.slice(0,places.length-20);this.setState({places:places});this.onUpdatePlaces(places);}}},{key:\"onBusinessFormChange\",value:function(){var _onBusinessFormChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(event){var _this8=this;var type;return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:type=event.target.value.replace(/ /g,'_');if(type=='hotels_/lodging')type='lodging';else if(type=='all')type='establishment';// clear places\nif(!(type=='none')){_context13.next=6;break;}this.setState({places_count:0,business_type_option:event.target.value,business_type:type,poi:'none'},function(){return _this8.onUpdatePlaces([]);});_context13.next=10;break;case 6:this.setState({places_count:20,business_type_option:event.target.value,business_type:type,poi:'none'});this.clearMarkers();_context13.next=10;return this.loadPlaceType(type,0);case 10:case\"end\":return _context13.stop();}}},_callee13,this);}));function onBusinessFormChange(_x10){return _onBusinessFormChange.apply(this,arguments);}return onBusinessFormChange;}()},{key:\"onPoiFormChange\",value:function(){var _onPoiFormChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(event){var _this9=this;var type;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:type=event.target.value.replace(/ /g,'_');if(type=='hotels_/lodging')type='lodging';else if(type=='all')type='establishment';if(!(type=='none')){_context14.next=6;break;}this.setState({places_count:0,poi:event.target.value,business_type:type,business_type_option:'none'},function(){return _this9.onUpdatePlaces([]);});_context14.next=10;break;case 6:this.setState({places_count:20,poi:event.target.value,business_type:type,business_type_option:'none'});this.clearMarkers();_context14.next=10;return this.loadPlaceType(type);case 10:case\"end\":return _context14.stop();}}},_callee14,this);}));function onPoiFormChange(_x11){return _onPoiFormChange.apply(this,arguments);}return onPoiFormChange;}()},{key:\"onPlacesCountChange\",value:// to do clean up & cache ffs\nfunction onPlacesCountChange(event){var _this10=this;this.setState({places_count:event.target.value});switch(event.target.value){case'20':var places=this.props.places;places=places.slice(0,20);this.setState({places:places});this.onUpdatePlaces(places);break;case'40':if(this.props.places.length<40){this.loadMorePlaces(20,false);}else{var places=this.props.places;places=places.slice(0,40);this.setState({places:places});this.onUpdatePlaces(places);}break;case'60':if(this.props.places.length<40){this.loadMorePlaces(20,true,function(){_this10.loadMorePlaces(40,false);});}else if(this.state.places.length==40){this.loadMorePlaces(40,false);}else{var places=this.props.places;places=places.slice(0,60);this.onUpdatePlaces(places);}break;}}},{key:\"onUpdatePlaces\",value:function onUpdatePlaces(data){var _this11=this;if(this.props.address.place.types.includes('establishment')){// check not to add two markers id address contains place\nvar updatedData=[this.state.addressPlace];data.map(function(e){if(e.place_id===undefined)return;if(e.place_id!==_this11.state.addressPlace.place_id)updatedData.push(e);});this.props.onUpdatePlaces(updatedData);}else this.props.onUpdatePlaces(data);}},{key:\"onUpdateActivePlace\",value:function onUpdateActivePlace(data){this.props.onUpdateActivePlace(data);}},{key:\"onUpdateTract\",value:function onUpdateTract(data){this.props.onUpdateTract(data);}},{key:\"getInfoContent\",value:function getInfoContent(place){return renderInfoContent.apply(this,[place]);}},{key:\"updateRadii\",value:function(){var _updateRadii=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var Manhattan,Brooklyn,Queens,Bronx,Staten,county,circle1Distance,circle2Distance,circle1,circle2,points,counter,divisor,increment,i,outerRing,_circle1Distance,_circle2Distance,_circle,_circle2,_points,_divisor,_increment,_counter,_i,_outerRing,_circle1Distance2,_circle2Distance2,_circle3,_circle4,_points2,_counter2,_divisor2,_increment2,_i2,_outerRing2;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:Manhattan=Boroughs.Manhattan,Brooklyn=Boroughs.Brooklyn,Queens=Boroughs.Queens,Bronx=Boroughs.Bronx,Staten=Boroughs.Staten;_context15.next=3;return getCounty(this.props.address.zip);case 3:county=_context15.sent;if(county){_context15.next=22;break;}// NJ, Long Island    \ncircle1Distance=4828;// 3 mi\ncircle2Distance=8046;// 0.5 mi\ncircle1=renderCircle(circle1Distance,\"#ffff00\",this.state.map,this.state.center);circle2=renderCircle(circle2Distance,\"#0000ff\",this.state.map,this.state.center);// to-do cleanup, add label\npoints=getPoints(this.state.center,4.828,1);renderComplexMarker('circle1',points[0],this.state.map,'3 mi',YELLOW_DOT_3,new google.maps.Point(60,60));points=getPoints(this.state.center,8.046,1);renderComplexMarker('circle2',points[0],this.state.map,'5 mi',BLUE_DOT_5,new google.maps.Point(60,60));// render test points\npoints=getPoints(this.state.center,4.8225,1);counter=1;divisor=10;increment=4.828/divisor;//4.828 = exact 3 miles 0.804672\nfor(i=1;i<=divisor;i++){points=points.concat(getPoints(this.state.center,i*increment,counter*8));counter+=1;}// render TZ pins \npoints.forEach(function(e,i){//          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n});outerRing=getPoints(this.state.center,8,80);outerRing.forEach(function(e,i){//        renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n});return _context15.abrupt(\"return\");case 22:if(county===Manhattan){// WALKING\n_circle1Distance=402;// 0.25 mi\n_circle2Distance=804;// 0.5 mi\n_circle=renderCircle(_circle1Distance,\"#ffff00\",this.state.map,this.state.center);_circle2=renderCircle(_circle2Distance,\"#0000ff\",this.state.map,this.state.center);// to-do cleanup, add label\n_points=getPoints(this.state.center,0.402,1);renderComplexMarker('circle1',_points[0],this.state.map,'0.25 mi',YELLOW_DOT_25,new google.maps.Point(60,60));_points=getPoints(this.state.center,0.804,1);renderComplexMarker('circle2',_points[0],this.state.map,'0.5 mi',BLUE_DOT_05,new google.maps.Point(60,60));// render test points\n_divisor=4;_increment=0.35/_divisor;// 0.2174799\n_counter=1;for(_i=1;_i<=_divisor;_i++){_points=_points.concat(getPoints(this.state.center,_i*_increment,_counter*8));_counter+=1;}_points.forEach(function(e,i){//          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n});_outerRing=getPoints(this.state.center,.800,50);_outerRing.forEach(function(e,i){//          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n});}else{// Brooklyn, Staten Island, Bronx    \n_circle1Distance2=804;// 0.5 mi\n_circle2Distance2=4828;// 3 mi\n_circle3=renderCircle(_circle1Distance2,\"#0000ff\",this.state.map,this.state.center);_circle4=renderCircle(_circle2Distance2,\"#ffff00\",this.state.map,this.state.center);// to-do cleanup, add label\n_points2=getPoints(this.state.center,0.804,1);renderComplexMarker('circle1',_points2[0],this.state.map,'0.5 mi',BLUE_DOT_05,new google.maps.Point(60,60));_points2=getPoints(this.state.center,4.828,1);renderComplexMarker('circle1',_points2[0],this.state.map,'3 mi',YELLOW_DOT_3,new google.maps.Point(60,60));// render test points\n_points2=getPoints(this.state.center,4.8225,1);_counter2=1;_divisor2=5;_increment2=0.8/_divisor2;//4.828 = exact 3 miles 0.804672\n//  0.804672km = 0.5miles\nfor(_i2=1;_i2<=_divisor2;_i2++){_points2=_points2.concat(getPoints(this.state.center,_i2*_increment2,_counter2*8));_counter2+=1;}_points2.forEach(function(e,i){//       renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n});_outerRing2=getPoints(this.state.center,4.828,80);_outerRing2.forEach(function(e,i){//  renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n});}case 23:case\"end\":return _context15.stop();}}},_callee15,this);}));function updateRadii(){return _updateRadii.apply(this,arguments);}return updateRadii;}()},{key:\"updateMapCenter\",value:function updateMapCenter(coords){this.setState({center:coords});}// markers\n},{key:\"updatePlaceDetails\",value:function updatePlaceDetails(callback){var _this12=this;// get details\nif(!this.state.place_details.has(this.props.active_place.place_id)){this.getPlaceDetails(this.state.map,this.props.active_place.place_id,function(details){_this12.state.place_details.set(_this12.props.active_place.place_id,details);// get photo\nif(!_this12.state.place_photos.has(_this12.props.active_place.place_id)){if(_this12.props.active_place.photos!==undefined){getPhoto(_this12.props.active_place.photos[0].photo_reference,400,400,function(data){_this12.state.place_photos.set(_this12.props.active_place.place_id,data.url);callback();});}else{callback();}}});}else{callback();}}},{key:\"render\",value:function render(){var _this13=this;var apiIsLoaded=function apiIsLoaded(map,maps,center){_this13.state.map=map;//    if (!this.props.address.place.types.includes('establishment')) {\nvar yourBusinessMarker=renderMarker('your_business',center,map,'Your Business',BLUE_MARKER);yourBusinessMarker.setZIndex(9999);var content='<h3>Your Location</h3>';//     var content ='<h3>Your ' + this.props.business_type.type.toString() +'</h3>'\nyourBusinessMarker.addListener('click',function(){infoWindow.setContent(content);infoWindow.open(map,yourBusinessMarker);infoWindow.marker=yourBusinessMarker;});//     }\n_this13.updateRadii();_this13.generateHeading();_this13.loadDefaultPlaces();// this.loadNearbySubways()\n};// const resultsDropDown = <div>\n//   <span style={{ color: 'whitesmoke'}}> Results</span>\n//   <Form.Control value={this.state.places_count} as=\"select\" name=\"places_count\" onChange={this.onPlacesCountChange}>\n//                 <option>20</option>\n//                 <option>40</option>\n//                 <option>60</option>\n//   </Form.Control>\n// </div>\nvar MapButtons=function MapButtons(){return/*#__PURE__*/_jsxs(\"div\",{className:\"map-control_bar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rowOne\",children:[/*#__PURE__*/_jsx(Button,{className:\"toolbar_button\",onClick:_this13.props.runJoyRideTutorial,children:\"?\"}),/*#__PURE__*/_jsx(Button,{className:\"toolbar_button\",variant:\"light\",onClick:_this13.onHandleCenter,children:\"Ctr\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"switch_container\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Street\"}),/*#__PURE__*/_jsx(SliderSwitch,{checked:_this13.state.siteView,switchFunction:_this13.onHandleSite})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"switch_container\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Overlay\"}),/*#__PURE__*/_jsx(SliderSwitch,{checked:true,switchFunction:_this13.handleSwitch})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"place_dropdown_container\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\" Other Businesses\"}),/*#__PURE__*/_jsxs(Form.Control,{value:_this13.state.business_type_option,as:\"select\",name:\"business_type\",onChange:_this13.onBusinessFormChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"none\"}),/*#__PURE__*/_jsx(\"option\",{children:\"all\"}),BUSINESS_TYPES.map(function(e,i){if(e!='residential'){return/*#__PURE__*/_jsx(\"option\",{children:e.replace(/_/g,' ')},i);}})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Places of Interest\"}),/*#__PURE__*/_jsxs(Form.Control,{value:_this13.state.poi,as:\"select\",name:\"poi\",onChange:_this13.onPoiFormChange,children:[/*#__PURE__*/_jsx(\"option\",{children:\"none\"}),/*#__PURE__*/_jsx(\"option\",{children:\"all\"}),POI_TYPES.map(function(e,i){return/*#__PURE__*/_jsx(\"option\",{children:e.replace(/_/g,' ')},i);})]})]})]})]});};// init street view only after heading is calculated\nvar streetViewContainer=/*#__PURE__*/_jsx(_Fragment,{});var streetView=/*#__PURE__*/_jsx(ReactStreetview,{ref:this.streetView,apiKey:GOOGLE_KEY,streetViewPanoramaOptions:{position:{lat:this.props.center.lat,lng:this.props.center.lng},pov:{heading:this.state.heading,pitch:0},zoom:1,source:google.maps.StreetViewSource.OUTDOOR},width:'400px',height:'400px'});if(this.state.heading!=undefined){streetViewContainer=streetView;}var MapBundle=/*#__PURE__*/_jsxs(\"div\",{className:\"googleMap_container\",children:[/*#__PURE__*/_jsx(GoogleMapReact,{ref:this.myRef,bootstrapURLKeys:{key:GOOGLE_KEY},center:this.state.center,zoom:this.state.zoom,yesIWantToUseGoogleMapApiInternals:true,layerTypes:['TrafficLayer','TransitLayer'],id:'map',onGoogleApiLoaded:function onGoogleApiLoaded(_ref12){var map=_ref12.map,maps=_ref12.maps;return apiIsLoaded(map,maps,_this13.state.center);},options:this.state.mapOptions,resetBoundsOnResize:true,onChange:this.handleChange}),this.state.siteView&&/*#__PURE__*/_jsx(\"div\",{className:\"streetView_container\",children:streetViewContainer}),this.state.loadingCart[this.props.data_range]==true&&/*#__PURE__*/_jsxs(\"div\",{className:\"fade_container\",children:[/*#__PURE__*/_jsx(FadeLoader,{color:\"#123abc\",size:10}),/*#__PURE__*/_jsx(\"span\",{children:\"Loading Overlay\"})]})]});return/*#__PURE__*/_jsxs(\"div\",{className:\"map_container\",children:[/*#__PURE__*/_jsx(MediaQuery,{minDeviceWidth:551,children:/*#__PURE__*/_jsx(MapButtons,{})}),/*#__PURE__*/_jsxs(MediaQuery,{maxDeviceWidth:550,children:[/*#__PURE__*/_jsx(Toolbar,{openToolBar:this.openToolBar}),this.state.toolsOpen&&/*#__PURE__*/_jsx(MapButtons,{})]}),this.state.hasListing&&/*#__PURE__*/_jsx(\"button\",{className:\"listingBanner\",onClick:this.navigateToListing,children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{style:{color:'black'},children:\"This location has a listing, click \"}),\" \",/*#__PURE__*/_jsx(\"span\",{style:{color:\"blue\"},children:\"here\"}),\" \",/*#__PURE__*/_jsx(\"span\",{style:{color:'black'},children:\" for details\"})]})}),/*#__PURE__*/_jsxs(MediaQuery,{maxDeviceWidth:550,children:[this.state.hasListing&&/*#__PURE__*/_jsx(\"div\",{style:{height:window.innerHeight-86-32},children:MapBundle}),!this.state.hasListing&&/*#__PURE__*/_jsx(\"div\",{style:{height:window.innerHeight-86},children:MapBundle})]}),/*#__PURE__*/_jsx(MediaQuery,{minDeviceWidth:551,children:/*#__PURE__*/_jsx(\"div\",{style:{height:this.state.hasListing?\"calc(\".concat(this.props.height,\" - 32px)\"):this.props.height},children:MapBundle})}),/*#__PURE__*/_jsxs(MediaQuery,{maxDeviceWidth:550,children:[/*#__PURE__*/_jsx(DemographicsPanel,{business_type:this.props.business_type,street:this.props.address.street,city:this.props.address.city,state:this.props.address.state,zip:this.props.address.zip,lat:this.props.address.coords.lat,lng:this.props.address.coords.lng,getHelpers:this.getHelpers,orientation:\"demographics-list-vertical \"}),/*#__PURE__*/_jsx(PlacesList,{}),/*#__PURE__*/_jsx(ChartsPanel,{}),/*#__PURE__*/_jsx(\"div\",{className:\"extrasContainer\",children:/*#__PURE__*/_jsx(TransportationPanel,{})})]})]});}}]);return SimpleMap;}(Component);SimpleMap.defaultProps={defaultCenter:{lat:59.95,lng:30.33},defaultzoom:11};var mapStateToProps=createSelector(placesSelector,activeSelector,addressSelector,businessTypeSelector,zipSelector,stateSelector,tractSelector,dataRangeSelector,isCitySelector,tradeZoneBoundsSelector,transportationSelector,geoUnitSelector,statsSelector,function(places,active_place,address,business_type,zip,state,tract,data_range,isCity,tradeZone_bounds,transportation,geo_unit,stats){return{places:places,active_place:active_place,address:address,business_type:business_type,zip:zip,state:state,tract:tract,data_range:data_range,isCity:isCity,tradeZone_bounds:tradeZone_bounds,transportation:transportation,geo_unit:geo_unit,stats:stats};});var mapActionsToProps={onUpdatePlaces:updatePlaces,onUpdateActivePlace:updateActivePlace,onUpdateTract:updateTract,onUpdateTradeZoneBounds:updateTradeZoneBounds,onUpdateTransportation:updateTransportation};export default withRouter(connect(mapStateToProps,mapActionsToProps)(SimpleMap));function distance(lat1,lon1,lat2,lon2,unit){if(lat1==lat2&&lon1==lon2){return 0;}else{var radlat1=Math.PI*lat1/180;var radlat2=Math.PI*lat2/180;var theta=lon1-lon2;var radtheta=Math.PI*theta/180;var dist=Math.sin(radlat1)*Math.sin(radlat2)+Math.cos(radlat1)*Math.cos(radlat2)*Math.cos(radtheta);if(dist>1){dist=1;}dist=Math.acos(dist);dist=dist*180/Math.PI;dist=dist*60*1.1515;if(unit==\"K\"){dist=dist*1.609344;}if(unit==\"N\"){dist=dist*0.8684;}return dist;}}","map":{"version":3,"names":["React","Component","GoogleMapReact","getNearby","getPages","getPhoto","connect","createSelector","updatePlaces","updateActivePlace","ReactDOMServer","DemographicsPanel","updateTract","Form","getPoints","ZIP","TRADE_ZONE","GOOGLE_KEY","google","BUSINESS_TYPES","POI_TYPES","renderCircle","renderMarker","renderComplexMarker","renderLargeMarker","renderInfoContent","BLUE_MARKER","YELLOW_MARKER","GREEN_MARKER","RED_MARKER","BLUE_DOT_05","YELLOW_DOT_25","YELLOW_DOT_3","BLUE_DOT_5","activeSelector","addressSelector","businessTypeSelector","dataRangeSelector","placesSelector","stateSelector","tractSelector","zipSelector","isCitySelector","tradeZoneBoundsSelector","transportationSelector","geoUnitSelector","statsSelector","SliderSwitch","Button","updateTradeZoneBounds","ReactStreetview","updateTransportation","createTradeZoneCartography","FadeLoader","getSubwayTotals","getListingByPlaceId","withRouter","MediaQuery","Toolbar","PlacesList","ChartsPanel","TransportationPanel","getCounty","Boroughs","infoWindow","maps","InfoWindow","SimpleMap","props","loadListing","address","place","place_id","res","undefined","length","setState","hasListing","listing","updatePlacesFromRedux","type","display_value","index","places_count","poi","business_type","business_type_option","onUpdatePlaces","clearMarkers","loadPlaceType","updatedMarkers","Map","state","markers","forEach","e","i","marker","setMap","places","set","onHandleCenter","center","siteView","updateMarkers","map","markers_to_keep","markerMap","Array","from","id","img","has","geometry","location","name","updateInfoWindow","key","value","addListener","onUpdateActivePlace","updatePlaceDetails","setContent","renderToStaticMarkup","getInfoContent","open","getPlaceDetails","callback","service","PlacesService","request","placeId","fields","getDetails","status","PlacesServiceStatus","OK","console","error","getOpen","opening_hours","answer","is_open","updateMarker","active_place","setIcon","handleSwitch","checked","renderCartography","clearCartography","onHandleSite","handleChange","event","onUpdateTransportation","transportation","loadNearbySubways","data","token","places_cache","get","tokens_cache","subwayCoords","entries","push","subway_data","dist","distance","coords","lat","lng","G_LAT","G_LNG","sort","x","y","transportObj","JSON","parse","stringify","subwayMap","G_TOTAL_ENT","G_LINES","subways","generateHeading","sv","StreetViewService","panorama","StreetViewPanorama","document","getElementById","position","getPanorama","radius","StreetViewStatus","marker_pano","Marker","heading","spherical","computeHeading","latLng","getPosition","setPov","pitch","navigateToListing","url","listingId","history","openToolBar","toolsOpen","myRef","createRef","streetView","place_details","place_photos","address_line","street","city","zip","boundaries","cartography","display_cartography","cartographyLoaded","aerial","zoom","mapType","MapTypeId","SATELLITE","loadingCart","mapOptions","streetViewControl","scaleControl","fullscreenControl","styles","featureType","elementType","stylers","visibility","gestureHandling","disableDoubleClickZoom","minZoom","maxZoom","mapTypeControl","mapTypeId","ROADMAP","mapTypeControlOptions","style","MapTypeControlStyle","HORIZONTAL_BAR","ControlPosition","BOTTOM_CENTER","mapTypeIds","HYBRID","zoomControl","clickableIcons","bind","onUpdateTract","lessPlaces","loadAllPlaces","loadMorePlaces","loadDefaultPlaces","exampleRef","getopen","onBusinessFormChange","loadZipCartography","onPlacesCountChange","updateRadii","initCache","onUpdateTradeZoneBounds","loadTradeZoneCartography","onPoiFormChange","setInterval","isBound","getMap","types","includes","window","scrollTo","top","behavior","isFirstTimeUser","updateIsFirstTime","innerWidth","runJoyRideTutorial","prevProps","prevState","toString","trigger","all_markers","values","markers_to_delete","slice","m","arr","data_range","showSubways","defaultPlace","business_option","replace","stats","tradezone","tradeZone_bounds","mCartography","Object","assign","collection","concat","feature","remove","featureSet","addGeoJson","setTimeout","addressPlace","details","icon","cached_places","morePlaces","hasCallback","target","updatedData","apply","Manhattan","Brooklyn","Queens","Bronx","Staten","county","circle1Distance","circle2Distance","circle1","circle2","points","Point","counter","divisor","increment","outerRing","photos","photo_reference","apiIsLoaded","yourBusinessMarker","setZIndex","content","MapButtons","streetViewContainer","pov","source","StreetViewSource","OUTDOOR","MapBundle","color","height","innerHeight","getHelpers","defaultProps","defaultCenter","defaultzoom","mapStateToProps","tract","isCity","geo_unit","mapActionsToProps","lat1","lon1","lat2","lon2","unit","radlat1","Math","PI","radlat2","theta","radtheta","sin","cos","acos"],"sources":["/Users/sumanthvarma/Desktop/frontend/src/Components/Map/index.js"],"sourcesContent":["import React, { Component } from 'react';\nimport GoogleMapReact from 'google-map-react';\nimport { getNearby, getPages, getPhoto } from '../../Requests/map-requests' \nimport '../../css/App.scss';\nimport { connect } from 'react-redux'\nimport { createSelector } from 'reselect';\nimport { updatePlaces } from '../../Actions/places-actions'\nimport { updateActivePlace } from '../../Actions/active-actions'\nimport ReactDOMServer from 'react-dom/server';\nimport DemographicsPanel from './Panels/DemographicsPanel'\nimport {updateTract} from '../../Actions/tract-actions'\nimport Form from 'react-bootstrap/Form'\nimport { getPoints } from '../../Helpers/TradeZone'\nimport { ZIP, TRADE_ZONE} from './Panels/DemographicsPanel'\nimport { GOOGLE_KEY, google, BUSINESS_TYPES, POI_TYPES } from '../../Constants.js'\nimport { renderCircle, renderMarker, renderComplexMarker, renderLargeMarker, renderInfoContent, BLUE_MARKER, YELLOW_MARKER, GREEN_MARKER, RED_MARKER, BLUE_DOT_05, YELLOW_DOT_25, YELLOW_DOT_3, BLUE_DOT_5 } from './GoogleMaps/GoogleMapComponents'\nimport { activeSelector, addressSelector, businessTypeSelector, dataRangeSelector, placesSelector, stateSelector, tractSelector, zipSelector, isCitySelector, tradeZoneBoundsSelector, transportationSelector, geoUnitSelector, statsSelector } from '../../Reducers/selectors'\nimport SliderSwitch from '../UI/SliderSwitch'\nimport Button from 'react-bootstrap/Button';\nimport { updateTradeZoneBounds } from '../../Actions/tradeZoneBoundaries-actions'\nimport ReactStreetview from 'react-streetview';\nimport { updateTransportation} from '../../Actions/transportation-actions'\nimport { createTradeZoneCartography } from '../../Requests/locations-requests'\nimport FadeLoader from '../UI/FadeLoader'\nimport { getSubwayTotals } from '../../Requests/subway-requests';\nimport { getListingByPlaceId } from \"../../Requests/listings-requests\"\nimport { withRouter } from 'react-router-dom'\nimport MediaQuery from 'react-responsive'\nimport Toolbar from '../Mobile/Toolbar'\nimport PlacesList from './Panels/PlacesList'\nimport ChartsPanel from './Panels/ChartsPanel'\n// import CommentsPanel from './Panels/CommentsPanel'\nimport TransportationPanel from './Panels/TransportationPanel'\nimport { getCounty } from '../utils/distance'\nimport { Boroughs } from '../utils/zipcodes'\n\nconst infoWindow =  new google.maps.InfoWindow()\n\nclass SimpleMap extends Component {\n  static defaultProps = {\n    defaultCenter: {\n      lat: 59.95,\n      lng: 30.33\n    },\n    defaultzoom: 11\n  };\n\n  constructor(props) {\n    super(props)\n    this.myRef = React.createRef();\n    this.streetView = React.createRef();\n    this.service = new google.maps.StreetViewService;\n    // let defaultPlace = this.props.business_type.type\n    // let type = this.props.business_type.type\n    // let business_option = type.replace(/_/g, ' ')\n    // if (type == 'lodging') type = 'hotels /lodging'\n    // else if (defaultPlace == 'residential') {\n    //   defaultPlace = 'establishment'\n    //   business_option = 'all'\n    // }\n\n    this.state = {\n      center: this.props.center,\n      map : undefined,\n      markers : new Map(),\n      place_details : new Map(),\n      place_photos : new Map(),\n      places_cache : new Map(),\n      tokens_cache : new Map(),\n      places_count : 20,\n      address_line : this.props.address.street + ', ' + this.props.address.city + ' ' + this.props.address.state + ', ' + this.props.address.zip,\n      boundaries : getPoints(this.props.center, 0.804, 1),\n      cartography : {},\n      display_cartography: true,\n      business_type: '', //defaultPlace,\n      cartographyLoaded : false,\n      poi : 'none',\n      business_type_option: '', //business_option,\n      aerial : true,\n      zoom : this.props.zoom,\n      siteView: false,\n      mapType : google.maps.MapTypeId.SATELLITE,\n      loadingCart : {[ZIP] : true, [TRADE_ZONE] : true},\n      mapOptions : {\n        streetViewControl: true,\n        scaleControl: true,\n        fullscreenControl: false,\n        styles: [{\n            featureType: \"poi.business\",\n            elementType: \"labels\",\n            stylers: [{\n                visibility: \"off\"\n            }]\n        }],\n        gestureHandling: \"greedy\",\n        disableDoubleClickZoom: true,\n        minZoom: 5,\n        maxZoom: 100,\n        mapTypeControl: true,\n        mapTypeId: google.maps.MapTypeId.ROADMAP,\n        mapTypeControlOptions: {\n            style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,\n            position: google.maps.ControlPosition.BOTTOM_CENTER,\n            mapTypeIds: [\n              google.maps.MapTypeId.ROADMAP,\n              google.maps.MapTypeId.SATELLITE,\n              google.maps.MapTypeId.HYBRID\n            ]\n        },\n        zoomControl: true,\n        clickableIcons: false\n      },\n\n      toolsOpen : false\n    }  \n  \n    this.onUpdatePlaces = this.onUpdatePlaces.bind(this);\n    this.onUpdateActivePlace = this.onUpdateActivePlace.bind(this);\n    this.onUpdateTract = this.onUpdateTract.bind(this)\n    this.lessPlaces = this.lessPlaces.bind(this);\n    this.loadAllPlaces = this.loadAllPlaces.bind(this);\n    this.loadMorePlaces = this.loadMorePlaces.bind(this);\n    this.loadDefaultPlaces = this.loadDefaultPlaces.bind(this);\n    this.exampleRef = React.createRef()\n    this.updateMarkers = this.updateMarkers.bind(this)\n    this.updateMarker = this.updateMarker.bind(this)\n    this.updateInfoWindow = this.updateInfoWindow.bind(this)\n    this.getopen  = this.getOpen.bind(this)\n    this.getPlaceDetails = this.getPlaceDetails.bind(this)\n    this.updatePlaceDetails = this.updatePlaceDetails.bind(this)\n    this.onBusinessFormChange = this.onBusinessFormChange.bind(this);\n    this.loadZipCartography = this.loadZipCartography.bind(this)\n    this.renderCartography = this.renderCartography.bind(this)\n    this.getInfoContent = this.getInfoContent.bind(this)\n    this.handleSwitch = this.handleSwitch.bind(this)\n    this.clearCartography = this.clearCartography.bind(this)\n    this.onPlacesCountChange = this.onPlacesCountChange.bind(this)\n    this.updateRadii =this.updateRadii.bind(this)\n    this.initCache = this.initCache.bind(this)\n    this.onUpdateTradeZoneBounds = this.onUpdateTradeZoneBounds.bind(this)\n    this.loadTradeZoneCartography = this.loadTradeZoneCartography.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n    this.onPoiFormChange = this.onPoiFormChange.bind(this)\n    \n    // to-do create function updateInfoWindow\n    setInterval(async () => {\n        let isBound = (infoWindow.getMap() ? true : false)\n        if (!isBound && infoWindow.marker != undefined && infoWindow.marker.key != 'your_business') {\n          let img = ''\n          if (infoWindow.marker.place.place_id == this.props.address.place.place_id) {\n            img = BLUE_MARKER\n          }\n          else if (this.props.business_type.type != 'residential' && infoWindow.marker.place.types.includes(this.props.business_type.type)) {\n            img = RED_MARKER\n          } else {\n            img = YELLOW_MARKER\n          }\n          infoWindow.marker.marker.setIcon(img)\n          this.onUpdateActivePlace(false)\n        }\n    }, 500);\n  }\n\n  async componentDidMount() {\n    window.scrollTo({ top: 0, behavior: 'smooth' })\n    this.initCache()\n    await this.loadListing()\n\n    // first time user check\n    if (this.props.isFirstTimeUser) {\n      this.props.updateIsFirstTime(false)\n      if (window.innerWidth > 550) {\n        this.props.runJoyRideTutorial()\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.onUpdatePlaces([])\n  }\n\n  async componentDidUpdate(prevProps, prevState) {\n    // active place change\n    if (this.props.active_place && this.props.active_place !== prevProps.active_place) \n      if (this.props.active_place.toString().length > 0) {\n        this.setState({center : this.props.active_place.geometry.location})\n        // highlight marker on map\n        if (prevProps.active_place.toString().length > 0) {\n          this.updateMarker(this.state.markers.get(prevProps.active_place.place_id))\n        }\n        this.state.markers.get(this.props.active_place.place_id).marker.setIcon(GREEN_MARKER)\n        google.maps.event.trigger(this.state.markers.get(this.props.active_place.place_id).marker, 'click')\n      }\n\n    // update markers \n    if (this.props.places !== prevProps.places && !(!this.state.siteView && prevState.siteView)) {\n      if (this.state.map != undefined) {\n        let all_markers =  Array.from(this.state.markers.values())\n        let markers_to_delete = [];\n        let markers_to_keep = new Map(); \n\n        if (prevProps.places.length > this.props.places.length) { \n          markers_to_delete = all_markers.slice(this.props.places.length, prevProps.places.length)\n          all_markers.slice(0, this.props.length).forEach(m => markers_to_keep.set(m.place_id, 0)) // set placeholder, actual value not needed\n        } \n        else if (prevProps.places.length < this.props.places.length) {\n   \n          let arr = all_markers.slice(0, prevProps.places.length)\n          arr.forEach(m => markers_to_keep.set(m.place_id, 0)) \n        } else {\n          this.clearMarkers()\n        }\n\n        // remove necesary markers\n        markers_to_delete.forEach(m => m.marker.setMap(null))\n        \n        // update all markers ....\n        this.updateMarkers(this.state.map, markers_to_keep)\n      }\n    }\n\n    // update geojson\n    if (this.state.map !== undefined) {\n      if (this.props.data_range !== prevProps.data_range) {\n        if (this.state.display_cartography)\n          await this.renderCartography()\n      }   \n    }\n\n    // reload subways on address change\n    if (prevProps.address != this.props.address) {\n      this.clearMarkers()\n      this.loadListing()\n  //    this.clearCartography()\n\n    }\n\n    // show subways on transportation change\n    if (prevProps.transportation.showSubways != this.props.transportation.showSubways) {\n      await this.loadNearbySubways()\n      this.updatePlacesFromRedux('subway_station', 'subway station', 4)\n    }\n\n\n    // change business type from demo panel\n    if (prevProps.business_type != this.props.business_type) {\n\n      let defaultPlace = this.props.business_type.type\n      let type = this.props.business_type.type\n      let business_option = type.replace(/_/g, ' ')\n      if (type == 'lodging') type = 'hotels /lodging'\n      else if (defaultPlace == 'residential') {\n        defaultPlace = 'establishment'\n        business_option = 'all'\n      }\n    //  await this.setState({ business_type : type, business_type_option : business_option })\n      this.clearMarkers()\n      this.updateMarkers(this.state.map, new Map())\n    }\n\n    // zip cart\n    if (prevProps.stats.zip !== this.props.stats.zip) {\n      this.loadZipCartography()  \n    }\n\n    //TZ cart\n    if (prevProps.stats.tradezone !== this.props.stats.tradezone) {\n      this.loadTradeZoneCartography()\n    }\n  }\n\n  loadListing = async () => {\n    let res = await getListingByPlaceId(this.props.address.place.place_id)\n    if (res === undefined) return;\n    if (res.length > 0) {\n      this.setState({ hasListing : true, listing: res[0] })\n    }\n  }\n\n  onUpdateTradeZoneBounds(tradeZone_bounds) {\n    this.props.onUpdateTradeZoneBounds(tradeZone_bounds)\n  }\n\n  async loadZipCartography() {\n    if (this.props.address.zip == undefined) return;\n      let mCartography = Object.assign({}, this.state.cartography)\n      let data = [this.props.stats.zip] \n      mCartography.zip = data\n        \n      this.setState({cartography : mCartography, loadingCart : {...this.state.loadingCart, [ZIP]: false}})\n      // init geojson rendering\n      this.renderCartography()\n  }\n    \n  async loadTradeZoneCartography() {\n    // get new tz cart with bounds \n    let data =  this.props.stats.tradezone.collection \n\n    let mCartography = Object.assign({}, this.state.cartography)\n    mCartography.tradezone = data\n    await this.setState({ cartography : mCartography, cartographyLoaded : true, loadingCart : {...this.state.loadingCart, [TRADE_ZONE] : false } })\n    this.renderCartography()\n  }\n\n\n\n  initCache() {\n     for (let type of BUSINESS_TYPES.concat(POI_TYPES).concat(['establishment'])) {\n       if (type == 'hotels /lodging') type = 'lodging'\n       this.state.places_cache.set(type, new Map())\n     }\n  }\n\n  clearCartography() {\n    if (this.state.map)\n    this.state.map.data.forEach((feature) => {\n      this.state.map.data.remove(feature)\n    })\n  }\n\n  renderCartography() {\n    // clear data layer \n      this.clearCartography()\n      // render cartography\n      if (this.props.data_range == ZIP) {\n        if (this.state.cartography.zip !== undefined && this.state.map) {\n          this.state.cartography.zip.forEach(featureSet => this.state.map.data.addGeoJson(featureSet))\n        } else {\n          setTimeout(() => this.renderCartography(), 100)\n        }\n      } \n      else if (this.props.data_range == TRADE_ZONE) {\n        if (this.state.cartography.tradezone !== undefined && this.state.map) {\n          this.state.cartography.tradezone.forEach(featureSet => this.state.map.data.addGeoJson(featureSet))\n       } else {\n         setTimeout(() => this.renderCartography(), 100)\n       }\n    }\n}\n\n  async loadDefaultPlaces() {\n    \n    // TO-DO: get placeId with address or from autofill\n    if (this.props.address.place.types.includes('establishment')) {  // get and set place for address if applicable \n      let place = this.props.address.place\n      await this.setState({ addressPlace : place})\n      this.getPlaceDetails(this.state.map, this.props.address.place.place_id, async (details) => {\n\n        place.icon = details.icon\n        place.name = details.name\n        place.place_id = details.id\n        this.state.place_details.set(place.id, details)\n      })\n    } \n\n    // await getNearby(this.props.address, this.state.business_type, (data, token) => {\n   \n    //   var morePlaces = this.props.places.concat(data)\n    //   this.setState({places: morePlaces})\n    //   for (let place of morePlaces) {\n    //     if (!this.state.places_cache.get(this.state.business_type).has(place.place_id)) {\n    //       this.state.places_cache.get(this.state.business_type).set(place.place_id, place)\n    //     } \n    //   }\n    //   this.state.tokens_cache.set(this.state.business_type, token)\n    //   if (this.props.address.place.types.includes('establishment')) {  // get and set place for address if applicable \n    //     this.getPlaceDetails(this.state.map, this.props.address.place.place_id, async (details) => {\n    //       let place = this.props.address.place\n    //       place.icon = details.icon\n    //       place.name = details.name\n    //       place.place_id = details.id\n    //       this.state.place_details.set(place.id, details)\n    //       await this.setState({ addressPlace : place})\n    //       this.onUpdatePlaces(data)\n    //     })\n    //   } else {\n    //     this.onUpdatePlaces(data)\n    //   }\n    //   this.setState({ places_count : 20 })\n    // })     \n  }\n\n  loadPlaceType(type, index) {\n\n    let cached_places = Array.from(this.state.places_cache.get(type).values())\n    if (cached_places.length == 0) {\n      // if not cached load places\n      getNearby(this.props.address, type, (data, token) => {\n   //     var morePlaces = this.props.places.concat(data)\n\n        this.setState({places: data})\n\n        // cache loaded places\n        for (let place of data) {\n          if (!this.state.places_cache.get(type).has(place.place_id)) {\n            this.state.places_cache.get(this.state.business_type).set(place.place_id, place)\n          } \n        }\n          this.state.tokens_cache.set(type, token)\n          this.onUpdatePlaces(data)\n        })\n      // if already cached \n    } else {\n      if (index == undefined) {\n        this.setState({places: cached_places.slice(0, 20)})\n        this.onUpdatePlaces(cached_places.slice(0,20))\n      } else {\n        this.setState({places: cached_places.slice(0, index)})\n        this.onUpdatePlaces(cached_places.slice(0, index))\n      }\n    }\n  }\n\n  loadAllPlaces() {\n    getNearby(this.props.address, 'establishment', (data, token) => {\n      var morePlaces = this.props.places.concat(data)\n      this.setState({places: morePlaces})\n      this.setState({ places_count : 20 })\n      this.state.tokens_cache.set('establishment', token)\n      this.onUpdatePlaces(data)\n    })\n  }\n\n  loadMorePlaces(index, hasCallback, callback) {\n        let cached_places = Array.from(this.state.places_cache.get(this.state.business_type).values())\n        if (cached_places.length > index) {\n          var morePlaces = this.state.places.concat(cached_places.slice(index, index + 20))\n          this.setState({places: morePlaces}, () => {\n            this.onUpdatePlaces(morePlaces)\n            if (hasCallback) { callback() }\n          })\n        } else {\n        getPages(this.state.tokens_cache.get(this.state.business_type), (data, token) => {\n        this.state.tokens_cache.set(this.state.business_type, token)\n        var morePlaces = this.props.places.concat(data)\n        for (let place of morePlaces) {\n          if (!this.state.places_cache.get(this.state.business_type).has(place.place_id)) {\n            this.state.places_cache.get(this.state.business_type).set(place.place_id, place)\n          } \n        }\n        this.setState({places: morePlaces}, () => {\n          this.onUpdatePlaces(morePlaces)\n          if (hasCallback) { callback() }\n        })\n      })\n    }\n  }\n  \n  lessPlaces() {\n    if (this.props.places.length > 20) {\n      var places = this.props.places\n      places = places.slice(0, (places.length-20))\n      this.setState({places: places})\n      this.onUpdatePlaces(places)\n    }\n  }\n\n  async onBusinessFormChange(event) {\n  \n    let type = event.target.value.replace(/ /g, '_')\n    if (type == 'hotels_/lodging') type = 'lodging'\n    else if (type == 'all') type = 'establishment'\n\n    // clear places\n    if (type == 'none') {\n      this.setState({places_count : 0, \n        business_type_option: event.target.value,\n        business_type: type,\n        poi : 'none'\n      }, () => this.onUpdatePlaces([]))\n\n    } else {\n      this.setState({places_count : 20, \n        business_type_option: event.target.value,\n        business_type: type,\n        poi : 'none'\n      })\n      this.clearMarkers()\n      await this.loadPlaceType(type, 0)\n    }\n  }\n\n  async onPoiFormChange(event) {\n    let type = event.target.value.replace(/ /g, '_')\n    if (type == 'hotels_/lodging') type = 'lodging'\n    else if (type == 'all') type = 'establishment'\n\n    if (type == 'none') {\n        this.setState({places_count : 0, \n          poi: event.target.value,\n          business_type : type,\n          business_type_option : 'none'\n        }, () => this.onUpdatePlaces([]))\n      \n    } else {\n      this.setState({places_count : 20, \n        poi : event.target.value, \n        business_type : type,\n        business_type_option : 'none'\n      })\n      this.clearMarkers()\n      await this.loadPlaceType(type)\n    }\n  }\n\n  updatePlacesFromRedux = async (type, display_value, index) => {\n    if (type == 'hotels_/lodging') type = 'lodging'\n    else if (type == 'all') type = 'establishment'\n\n    if (type == 'none') {\n        this.setState({places_count : 0, \n          poi: display_value,\n          business_type : type,\n          business_type_option : 'none'\n        }, () => this.onUpdatePlaces([]))\n      \n    } else {\n      this.setState({places_count : index+1, \n        poi : display_value, \n        business_type : type,\n        business_type_option : 'none'\n      })\n      this.clearMarkers()\n      await this.loadPlaceType(type, index)\n    }\n  }\n\n  clearMarkers = () => {\n    // clear markers \n    let updatedMarkers = new Map()\n    this.state.markers.forEach((e, i) => {\n       e.marker.setMap(null)\n       if (i < this.props.places.length) \n          updatedMarkers.set(e.place_id, e)\n    })\n    this.setState({ markers: updatedMarkers})\n  }\n\n\n  // to do clean up & cache ffs\n  onPlacesCountChange(event) {\n    this.setState({places_count: event.target.value})\n      switch (event.target.value) {\n        case '20':\n            var places = this.props.places\n            places = places.slice(0, 20)\n            this.setState({places: places})\n            this.onUpdatePlaces(places)\n            break;\n\n        case '40':\n            if (this.props.places.length < 40) {\n              this.loadMorePlaces(20, false)\n            } else {\n              var places = this.props.places\n              places = places.slice(0, 40)\n              this.setState({places: places})\n              this.onUpdatePlaces(places)\n            }\n            break;\n\n        case '60':\n            if (this.props.places.length < 40) {\n              this.loadMorePlaces(20, true, ()=> {\n                this.loadMorePlaces(40, false)\n              })\n              \n            } else if (this.state.places.length == 40) {\n              this.loadMorePlaces(40, false)\n            }\n            else {\n              var places = this.props.places\n              places = places.slice(0, 60)\n              this.onUpdatePlaces(places)\n            }\n            break;\n      }\n  }\n\n  onUpdatePlaces(data) {\n    if (this.props.address.place.types.includes('establishment')) { // check not to add two markers id address contains place\n      let updatedData = [this.state.addressPlace]\n      data.map(e => {\n        if (e.place_id === undefined) return\n        if (e.place_id !== this.state.addressPlace.place_id)\n          updatedData.push(e)\n      })\n      this.props.onUpdatePlaces(updatedData)\n    } else \n      this.props.onUpdatePlaces(data)\n  }\n  \n  onUpdateActivePlace(data) {\n    this.props.onUpdateActivePlace(data)\n  }\n  onUpdateTract(data) {\n    this.props.onUpdateTract(data)\n  }\n  getInfoContent(place) {\n   return renderInfoContent.apply(this, [place])\n  }\n\n  async updateRadii() {\n    const { Manhattan, Brooklyn, Queens, Bronx, Staten } = Boroughs;\n\n    const county = await getCounty(this.props.address.zip)\n      if (!county) {\n          // NJ, Long Island    \n          let circle1Distance = 4828 // 3 mi\n          let circle2Distance = 8046 // 0.5 mi\n          const circle1 = renderCircle(circle1Distance, \"#ffff00\", this.state.map, this.state.center) \n          const circle2 = renderCircle(circle2Distance, \"#0000ff\", this.state.map, this.state.center) \n          // to-do cleanup, add label\n          let points = getPoints(this.state.center, 4.828, 1)\n          renderComplexMarker('circle1', points[0], this.state.map, '3 mi', YELLOW_DOT_3, new google.maps.Point(60, 60))\n          points = getPoints(this.state.center, 8.046, 1)\n          renderComplexMarker('circle2', points[0], this.state.map, '5 mi', BLUE_DOT_5, new google.maps.Point(60, 60))\n   \n          // render test points\n          points = getPoints(this.state.center, 4.8225, 1)\n          let counter = 1\n          let divisor = 10;\n          let increment = 4.828 / divisor //4.828 = exact 3 miles 0.804672\n                \n                for (let i=1; i <= divisor; i++) {\n                    points = points.concat(getPoints(this.state.center, i*increment, counter*8))\n                    counter+=1\n                }\n  \n          // render TZ pins \n          points.forEach((e, i) => {\n  //          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n          })\n        \n          let outerRing = getPoints(this.state.center, 8, 80)\n          outerRing.forEach((e,i) => {\n   //        renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n          })\n        return;\n    }\n   \n\n      if (county === Manhattan) {\n        // WALKING\n        let circle1Distance = 402 // 0.25 mi\n        let circle2Distance = 804 // 0.5 mi\n         const circle1 = renderCircle(circle1Distance, \"#ffff00\", this.state.map, this.state.center) \n         const circle2 = renderCircle(circle2Distance, \"#0000ff\", this.state.map, this.state.center) \n        // to-do cleanup, add label\n        let points = getPoints(this.state.center, 0.402, 1)\n        renderComplexMarker('circle1', points[0], this.state.map, '0.25 mi', YELLOW_DOT_25, new google.maps.Point(60, 60))\n        points = getPoints(this.state.center, 0.804, 1)\n        renderComplexMarker('circle2', points[0], this.state.map, '0.5 mi', BLUE_DOT_05, new google.maps.Point(60, 60))\n      \n        // render test points\n        let divisor = 4;\n        let increment = 0.35 / divisor // 0.2174799\n        let counter = 1 \n        for (let i=1; i <= divisor; i++) {\n            points = points.concat(getPoints(this.state.center, i*increment, counter*8))\n            counter+=1\n        }\n                \n        points.forEach((e, i) => {\n  //          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n        })\n\n        let outerRing = getPoints(this.state.center, .800, 50)\n        outerRing.forEach((e,i) => {\n  //          renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n        })\n      \n      } else  {\n        // Brooklyn, Staten Island, Bronx    \n        let circle1Distance = 804  // 0.5 mi\n        let circle2Distance =  4828 // 3 mi\n        const circle1 = renderCircle(circle1Distance, \"#0000ff\", this.state.map, this.state.center) \n        const circle2 = renderCircle(circle2Distance, \"#ffff00\", this.state.map, this.state.center) \n        // to-do cleanup, add label\n        let points = getPoints(this.state.center, 0.804, 1)\n        renderComplexMarker('circle1', points[0], this.state.map, '0.5 mi', BLUE_DOT_05, new google.maps.Point(60, 60))\n        points = getPoints(this.state.center, 4.828, 1)\n        renderComplexMarker('circle1', points[0], this.state.map, '3 mi', YELLOW_DOT_3, new google.maps.Point(60, 60))\n \n        // render test points\n        points = getPoints(this.state.center, 4.8225, 1)\n        let counter = 1\n        let divisor = 5;\n        let increment = 0.8/ divisor //4.828 = exact 3 miles 0.804672\n        //  0.804672km = 0.5miles\n        \n        for (let i=1; i <= divisor; i++) {\n            points = points.concat(getPoints(this.state.center, i*increment, counter*8))\n            counter+=1\n        }\n\n        points.forEach((e, i) => {\n   //       renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, GREEN_MARKER)\n        })\n      \n        let outerRing = getPoints(this.state.center, 4.828, 80)\n        outerRing.forEach((e,i) => {\n       //  renderMarker(i, e, this.state.map, e.lat + ', ' + e.lng, RED_MARKER)\n        })\n    }\n  }\n\n  onHandleCenter= () => {\n    this.setState({ center : this.props.center })\n    if (this.state.siteView) this.setState({siteView: false})\n  }\n  \n  updateMapCenter(coords)  {\n    this.setState({\n        center: coords\n    });\n} \n\n   // markers\n  updateMarkers = (map, markers_to_keep) =>  {\n    let markerMap = this.state.markers\n    \n    \n    Array.from(this.props.places).map((place, i) => {\n      var id= place.place_id\n      var img = ''\n      var marker;\n      // filter preexisting places\n      if (!markers_to_keep.has(id)) { \n\n          if (this.props.business_type.type != 'residential' && this.props.business_type.type == this.state.business_type) {\n            img = RED_MARKER\n          } else {\n            img = YELLOW_MARKER\n          }\n            marker = renderMarker(i, place.geometry.location, map, place.name, img)\n            markerMap.set(id, {marker: marker, place: place})\n      }\n    })\n  this.setState({ markers : markerMap})\n  this.updateInfoWindow(map)\n};\n\nupdateInfoWindow = (map) => Array.from(this.state.markers, ([key, value]) =>  {\n\n  // to close window on exit\n  value.marker.addListener('click',  () => {\n       this.onUpdateActivePlace(value.place)\n        this.updatePlaceDetails(() => {\n          infoWindow.setContent(ReactDOMServer.renderToStaticMarkup(this.getInfoContent(value.place)))\n          infoWindow.marker = value\n          infoWindow.open(map, value.marker) \n        });\n       })\n});\n\nupdatePlaceDetails(callback) {\n\n  // get details\n  if (!this.state.place_details.has(this.props.active_place.place_id)) {\n    this.getPlaceDetails(this.state.map, this.props.active_place.place_id, (details) => {\n      this.state.place_details.set(this.props.active_place.place_id, details)\n\n         // get photo\n    if (!this.state.place_photos.has(this.props.active_place.place_id)) {\n      if (this.props.active_place.photos !== undefined) {\n       getPhoto(this.props.active_place.photos[0].photo_reference, 400, 400, (data) => {\n        this.state.place_photos.set(this.props.active_place.place_id, data.url)\n        callback()\n      })\n      } else {\n        callback()\n      }\n    }\n    })\n  } else {\n    callback()\n  }\n};\n\ngetPlaceDetails = (map, place_id, callback) => {\n  var service = new google.maps.places.PlacesService(map);\n  var request = {\n    placeId: place_id,\n    fields: ['id', 'name', 'icon', 'formatted_address', 'website']\n  };\n  \n     // get details\n    service.getDetails(request, (place, status) => {\n      if (status === google.maps.places.PlacesServiceStatus.OK) {\n        callback(place)\n      } else {\n        console.error('error', status)\n      }\n    });\n};\n\ngetOpen = (opening_hours) => {\n  if (opening_hours === undefined)\n    return 'Unknown'\n  else {\n    let answer = (opening_hours.is_open) ? \"Yes\" : \"No\"\n    return answer\n  }\n};\n\nupdateMarker = (marker) => {\n  if (marker == undefined) \n    return; \n\n  var img = ''\n  if (marker.place.place_id == this.props.address.place.place_id) {\n    img = BLUE_MARKER\n  }\n  else if (marker.place_id === this.props.active_place.place_id) {\n    img = GREEN_MARKER\n  } else if (this.props.business_type.type != 'residential' && this.props.business_type.type == this.state.business_type){\n    img = RED_MARKER\n  } else {\n    img = YELLOW_MARKER\n  }\n  marker.marker.setIcon(img)\n};\n\nhandleSwitch = (checked) => {\n  if (checked) {\n    this.renderCartography()\n  } else {\n    this.clearCartography()\n  }\n};\n\nonHandleSite = (checked) => {\n  if (checked) {\n    this.setState({ siteView : true})\n  } else {\n    this.setState({ siteView : false})\n  }\n};\n\nhandleChange = (event) => {\n  this.setState({ center : event.center})\n};\n\n// subways \nonUpdateTransportation = async (transportation) => {\n  this.props.onUpdateTransportation(transportation)\n};\n\nloadNearbySubways = async () => {\n  let type = 'subway_station'\n  getNearby(this.props.address, type, async (data, token) => {\n      // cache loaded places\n      for (let place of data) {\n        if (!this.state.places_cache.get(type).has(place.place_id)) {\n          this.state.places_cache.get(type).set(place.place_id, place)\n        } \n      }\n      this.state.tokens_cache.set(type, token)\n      let subwayCoords = []\n      Array.from(this.state.places_cache.get(type).entries()).map(([key, value], i) => {\n        if ( i > 4) return;\n        subwayCoords.push(value.geometry.location)\n      })\n      \n      let subway_data = await getSubwayTotals(subwayCoords)\n      // Calculate distance //////\n      subway_data.forEach(e => {\n        let dist= distance(this.props.address.coords.lat, this.props.address.coords.lng,\n          e.data.G_LAT, e.data.G_LNG)\n          e.distance = dist\n      })\n\n      subway_data.sort((x, y) => {\n        if (x.distance < y.distance) {\n          return -1;\n        }\n        if (x.distance > y.distance) {\n          return 1;\n        }\n        return 0;\n      })\n      \n        let transportObj = JSON.parse(JSON.stringify(this.props.transportation))\n        if (transportObj == '') { transportObj = {}}\n    \n        // clean up subway data\n        let subwayMap = new Map()\n        for (let i=0; i< subway_data.length; i++) {\n          if (!subwayMap.has(subway_data[i].name)) {\n            subwayMap.set(subway_data[i].name, subway_data[i].data)\n          } else {\n            // check if values are equal, if so arggregate to one location\n            if (subwayMap.get(subway_data[i].name).G_TOTAL_ENT == subway_data[i].data.G_TOTAL_ENT) {\n              subwayMap.set(subway_data[i].name, \n                {...subwayMap.get(subway_data[i].name), \n                  G_LINES : subwayMap.get(subway_data[i].name).G_LINES +'-'+ subway_data[i].data.G_LINES \n                })\n            }\n          }\n        }\n        transportObj.subways = subwayMap\n        await this.onUpdateTransportation(transportObj)\n\n    })       \n};\n\ngenerateHeading = () => {\n  var sv = new google.maps.StreetViewService();\n // initialize a new panorama API object and point to the element with ID streetview as container\n var panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'), {position: this.props.center});\n\n    sv.getPanorama({\n        location: this.props.center,\n        radius: 50\n    }, (data, status) => {\n      if (status === google.maps.StreetViewStatus.OK) {\n  \n          var marker_pano = new google.maps.Marker({\n              position: this.props.center,\n              map: panorama\n          });\n  \n          var heading = google.maps.geometry.spherical.computeHeading(data.location.latLng, marker_pano.getPosition());\n  \n          panorama.setPov({\n              heading: heading,\n              pitch: 0\n          });\n          this.setState({heading: heading})\n      }\n  });\n}\n\n// navigate to listing view\nnavigateToListing = () => {\n  let url = '/listing/' + this.state.listing.listingId\n  this.props.history.push(url)\n}\n\nopenToolBar = () => {\n  this.setState({ toolsOpen : !this.state.toolsOpen })\n}\n\n  render() {\n    const apiIsLoaded = (map, maps, center) => {\n      this.state.map = map\n  //    if (!this.props.address.place.types.includes('establishment')) {\n        let yourBusinessMarker = renderMarker('your_business', center, map, 'Your Business', BLUE_MARKER)\n        yourBusinessMarker.setZIndex(9999)\n        const content = '<h3>Your Location</h3>'\n   //     var content ='<h3>Your ' + this.props.business_type.type.toString() +'</h3>'\n          yourBusinessMarker.addListener('click', () => {\n            infoWindow.setContent(content)\n            infoWindow.open(map, yourBusinessMarker)\n            infoWindow.marker = yourBusinessMarker\n        })\n//     }\n      this.updateRadii()\n\n      this.generateHeading()\n      this.loadDefaultPlaces()\n     // this.loadNearbySubways()\n    }\n\n    // const resultsDropDown = <div>\n    //   <span style={{ color: 'whitesmoke'}}> Results</span>\n    //   <Form.Control value={this.state.places_count} as=\"select\" name=\"places_count\" onChange={this.onPlacesCountChange}>\n    //                 <option>20</option>\n    //                 <option>40</option>\n    //                 <option>60</option>\n    //   </Form.Control>\n    // </div>\n\n  const MapButtons = () => \n    \n    <div className='map-control_bar'>\n      <div className=\"rowOne\">\n        <Button className=\"toolbar_button\" onClick={this.props.runJoyRideTutorial}>?</Button>\n        <Button className=\"toolbar_button\" variant=\"light\" onClick={this.onHandleCenter}>Ctr</Button>\n          \n        <div className=\"switch_container\">\n            <span>Street</span>\n            <SliderSwitch checked={this.state.siteView} switchFunction={this.onHandleSite}></SliderSwitch>\n        </div>\n        <div className=\"switch_container\">\n          <span>Overlay</span>\n          <SliderSwitch checked={true} switchFunction={this.handleSwitch}></SliderSwitch>\n        </div>\n      </div>\n        <div className=\"place_dropdown_container\">\n          <div>\n            <span> Other Businesses</span>\n            <Form.Control value={this.state.business_type_option} as=\"select\" name=\"business_type\" onChange={this.onBusinessFormChange}>\n                          <option>none</option>\n                          <option>all</option>\n                        {BUSINESS_TYPES.map((e, i) => {\n                          if (e != 'residential') {\n                              return <option  key={i}>{e.replace(/_/g, ' ')}</option>\n                          }\n                        })}\n            </Form.Control>\n          </div>\n          <div>\n            <span>Places of Interest</span>\n            <Form.Control value={this.state.poi} as=\"select\" name=\"poi\" onChange={this.onPoiFormChange}>\n                        <option>none</option>\n                        <option>all</option>\n                        {POI_TYPES.map((e, i) => {\n                          return <option key={i}>{e.replace(/_/g, ' ')}</option>\n                        })}\n            </Form.Control>\n          </div>\n        </div>\n    </div>\n\n\n    // init street view only after heading is calculated\n    let streetViewContainer = <></>\n    const streetView =  <ReactStreetview\n    ref={this.streetView}\n    apiKey={GOOGLE_KEY}\n    streetViewPanoramaOptions={{\n      position: {lat: this.props.center.lat, lng: this.props.center.lng},\n      pov: {heading: this.state.heading, pitch: 0},\n      zoom: 1,\n      source: google.maps.StreetViewSource.OUTDOOR\n    }}\n    width={'400px'}\n    height={'400px'}\n  />;\n\n    if (this.state.heading != undefined) {\n      streetViewContainer = streetView;\n  }\n\n  const MapBundle = <div className=\"googleMap_container\">\n        <GoogleMapReact\n          ref={this.myRef}\n            bootstrapURLKeys={{ key: GOOGLE_KEY}}\n            center={this.state.center}\n            zoom={this.state.zoom}\n            yesIWantToUseGoogleMapApiInternals={true}\n            layerTypes={['TrafficLayer', 'TransitLayer']}\n            id={'map'}\n            onGoogleApiLoaded={({ map, maps }) => apiIsLoaded(map, maps, this.state.center)}\n            options= {this.state.mapOptions}\n            resetBoundsOnResize = {true}\n            onChange={this.handleChange}\n          />\n        {this.state.siteView && \n        <div className=\"streetView_container\">\n          {streetViewContainer}\n        </div>}\n        {this.state.loadingCart[this.props.data_range] == true && \n          <div className=\"fade_container\">\n            <FadeLoader color='#123abc' size={10}/>\n            <span>Loading Overlay</span>\n          </div>\n        }\n  </div>\n\n    return (\n      <div className='map_container'>\n\n        <MediaQuery minDeviceWidth={551}><MapButtons/></MediaQuery>\n        <MediaQuery maxDeviceWidth={550}>\n          <Toolbar openToolBar={this.openToolBar}/>\n          {this.state.toolsOpen && <MapButtons/>}\n        </MediaQuery>\n\n          {this.state.hasListing && \n            <button className=\"listingBanner\" onClick={this.navigateToListing}>\n              <div>\n                <span style={{ color: 'black'}}>This location has a listing, click </span> <span style={{ color : \"blue\"}}>here</span> <span style={{ color: 'black'}}> for details</span>\n              </div>\n            </button>\n          }\n\n         <MediaQuery maxDeviceWidth={550}>    \n            {this.state.hasListing &&  <div style={{height: window.innerHeight - 86 - 32 }}>\n                  {MapBundle}\n              </div>\n            }\n            {!this.state.hasListing &&  <div style={{height: window.innerHeight - 86 }}>\n                {MapBundle}\n              </div>\n            } \n         </MediaQuery>\n\n         <MediaQuery minDeviceWidth={551}>\n            <div style={{height:  (this.state.hasListing) ? `calc(${this.props.height} - 32px)` : this.props.height }}>     \n              {MapBundle}\n            </div>\n         </MediaQuery>\n        \n        <MediaQuery maxDeviceWidth={550}>\n           \n          <DemographicsPanel \n             business_type={this.props.business_type} \n             street = {this.props.address.street}\n             city = {this.props.address.city}\n             state = {this.props.address.state}\n             zip = {this.props.address.zip}\n             lat = {this.props.address.coords.lat}\n             lng = {this.props.address.coords.lng}\n             getHelpers={this.getHelpers}\n             orientation = {\"demographics-list-vertical \"}>\n           </DemographicsPanel>\n\n           <PlacesList/>\n           <ChartsPanel />\n          <div className=\"extrasContainer\">\n            <TransportationPanel/>\n            {/* <CommentsPanel/> */}\n          </div>\n        </MediaQuery>\n      </div>\n    );\n  }\n}\n\n\nconst mapStateToProps = createSelector(\n  placesSelector, \n  activeSelector,\n  addressSelector,\n  businessTypeSelector,\n  zipSelector,\n  stateSelector,\n  tractSelector,\n  dataRangeSelector,\n  isCitySelector,\n  tradeZoneBoundsSelector,\n  transportationSelector, \n  geoUnitSelector,\n  statsSelector,\n  (places, active_place, address, business_type, zip, state, tract, data_range, isCity, tradeZone_bounds, transportation, geo_unit, stats) => ({\n    places, \n    active_place,\n    address,\n    business_type,\n    zip,\n    state, \n    tract,\n    data_range,\n    isCity,\n    tradeZone_bounds,\n    transportation,\n    geo_unit,\n    stats\n  })\n);\n \nconst mapActionsToProps = {\n  onUpdatePlaces: updatePlaces,\n  onUpdateActivePlace: updateActivePlace,\n  onUpdateTract: updateTract,\n  onUpdateTradeZoneBounds: updateTradeZoneBounds,\n  onUpdateTransportation: updateTransportation\n};\n\nexport default withRouter(connect(mapStateToProps, mapActionsToProps) (SimpleMap));\n\n\nfunction distance(lat1, lon1, lat2, lon2, unit) {\n\tif ((lat1 == lat2) && (lon1 == lon2)) {\n\t\treturn 0;\n\t}\n\telse {\n\t\tvar radlat1 = Math.PI * lat1/180;\n\t\tvar radlat2 = Math.PI * lat2/180;\n\t\tvar theta = lon1-lon2;\n\t\tvar radtheta = Math.PI * theta/180;\n\t\tvar dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);\n\t\tif (dist > 1) {\n\t\t\tdist = 1;\n\t\t}\n\t\tdist = Math.acos(dist);\n\t\tdist = dist * 180/Math.PI;\n\t\tdist = dist * 60 * 1.1515;\n\t\tif (unit==\"K\") { dist = dist * 1.609344 }\n\t\tif (unit==\"N\") { dist = dist * 0.8684 }\n\t\treturn dist;\n\t}\n}"],"mappings":"u2CAAA,MAAOA,MAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,MAAOC,eAAP,KAA2B,kBAA3B,CACA,OAASC,SAAT,CAAoBC,QAApB,CAA8BC,QAA9B,KAA8C,6BAA9C,CACA,MAAO,oBAAP,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,cAAT,KAA+B,UAA/B,CACA,OAASC,YAAT,KAA6B,8BAA7B,CACA,OAASC,iBAAT,KAAkC,8BAAlC,CACA,MAAOC,eAAP,KAA2B,kBAA3B,CACA,MAAOC,kBAAP,KAA8B,4BAA9B,CACA,OAAQC,WAAR,KAA0B,6BAA1B,CACA,MAAOC,KAAP,KAAiB,sBAAjB,CACA,OAASC,SAAT,KAA0B,yBAA1B,CACA,OAASC,GAAT,CAAcC,UAAd,KAA+B,4BAA/B,CACA,OAASC,UAAT,CAAqBC,MAArB,CAA6BC,cAA7B,CAA6CC,SAA7C,KAA8D,oBAA9D,CACA,OAASC,YAAT,CAAuBC,YAAvB,CAAqCC,mBAArC,CAA0DC,iBAA1D,CAA6EC,iBAA7E,CAAgGC,WAAhG,CAA6GC,aAA7G,CAA4HC,YAA5H,CAA0IC,UAA1I,CAAsJC,WAAtJ,CAAmKC,aAAnK,CAAkLC,YAAlL,CAAgMC,UAAhM,KAAkN,kCAAlN,CACA,OAASC,cAAT,CAAyBC,eAAzB,CAA0CC,oBAA1C,CAAgEC,iBAAhE,CAAmFC,cAAnF,CAAmGC,aAAnG,CAAkHC,aAAlH,CAAiIC,WAAjI,CAA8IC,cAA9I,CAA8JC,uBAA9J,CAAuLC,sBAAvL,CAA+MC,eAA/M,CAAgOC,aAAhO,KAAqP,0BAArP,CACA,MAAOC,aAAP,KAAyB,oBAAzB,CACA,MAAOC,OAAP,KAAmB,wBAAnB,CACA,OAASC,qBAAT,KAAsC,2CAAtC,CACA,MAAOC,gBAAP,KAA4B,kBAA5B,CACA,OAASC,oBAAT,KAAoC,sCAApC,CACA,OAASC,0BAAT,KAA2C,mCAA3C,CACA,MAAOC,WAAP,KAAuB,kBAAvB,CACA,OAASC,eAAT,KAAgC,gCAAhC,CACA,OAASC,mBAAT,KAAoC,kCAApC,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,MAAOC,WAAP,KAAuB,kBAAvB,CACA,MAAOC,QAAP,KAAoB,mBAApB,CACA,MAAOC,WAAP,KAAuB,qBAAvB,CACA,MAAOC,YAAP,KAAwB,sBAAxB,CACA;AACA,MAAOC,oBAAP,KAAgC,8BAAhC,CACA,OAASC,SAAT,KAA0B,mBAA1B,CACA,OAASC,QAAT,KAAyB,mBAAzB,C,6IAEA,GAAMC,WAAU,CAAI,GAAI9C,OAAM,CAAC+C,IAAP,CAAYC,UAAhB,EAApB,C,GAEMC,U,sGASJ,mBAAYC,KAAZ,CAAmB,4DACjB,uBAAMA,KAAN,EADiB,MAgOnBC,WAhOmB,wEAgOL,mKACId,oBAAmB,CAAC,MAAKa,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyBC,QAA1B,CADvB,QACRC,GADQ,oBAERA,GAAG,GAAKC,SAFA,kEAGZ,GAAID,GAAG,CAACE,MAAJ,CAAa,CAAjB,CAAoB,CAClB,MAAKC,QAAL,CAAc,CAAEC,UAAU,CAAG,IAAf,CAAqBC,OAAO,CAAEL,GAAG,CAAC,CAAD,CAAjC,CAAd,EACD,CALW,sDAhOK,SA0cnBM,qBA1cmB,6FA0cK,kBAAOC,IAAP,CAAaC,aAAb,CAA4BC,KAA5B,wHACtB,GAAIF,IAAI,EAAI,iBAAZ,CAA+BA,IAAI,CAAG,SAAP,CAA/B,IACK,IAAIA,IAAI,EAAI,KAAZ,CAAmBA,IAAI,CAAG,eAAP,CAFF,KAIlBA,IAAI,EAAI,MAJU,2BAKlB,MAAKJ,QAAL,CAAc,CAACO,YAAY,CAAG,CAAhB,CACZC,GAAG,CAAEH,aADO,CAEZI,aAAa,CAAGL,IAFJ,CAGZM,oBAAoB,CAAG,MAHX,CAAd,CAIG,iBAAM,OAAKC,cAAL,CAAoB,EAApB,CAAN,EAJH,EALkB,8BAYpB,MAAKX,QAAL,CAAc,CAACO,YAAY,CAAGD,KAAK,CAAC,CAAtB,CACZE,GAAG,CAAGH,aADM,CAEZI,aAAa,CAAGL,IAFJ,CAGZM,oBAAoB,CAAG,MAHX,CAAd,EAKA,MAAKE,YAAL,GAjBoB,uBAkBd,OAAKC,aAAL,CAAmBT,IAAnB,CAAyBE,KAAzB,CAlBc,yDA1cL,8EAgenBM,YAhemB,CAgeJ,UAAM,CACnB;AACA,GAAIE,eAAc,CAAG,GAAIC,IAAJ,EAArB,CACA,MAAKC,KAAL,CAAWC,OAAX,CAAmBC,OAAnB,CAA2B,SAACC,CAAD,CAAIC,CAAJ,CAAU,CAClCD,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgB,IAAhB,EACA,GAAIF,CAAC,CAAG,MAAK5B,KAAL,CAAW+B,MAAX,CAAkBxB,MAA1B,CACGe,cAAc,CAACU,GAAf,CAAmBL,CAAC,CAACvB,QAArB,CAA+BuB,CAA/B,EACL,CAJD,EAKA,MAAKnB,QAAL,CAAc,CAAEiB,OAAO,CAAEH,cAAX,CAAd,EACD,CAzekB,OAopBnBW,cAppBmB,CAopBH,UAAM,CACpB,MAAKzB,QAAL,CAAc,CAAE0B,MAAM,CAAG,MAAKlC,KAAL,CAAWkC,MAAtB,CAAd,EACA,GAAI,MAAKV,KAAL,CAAWW,QAAf,CAAyB,MAAK3B,QAAL,CAAc,CAAC2B,QAAQ,CAAE,KAAX,CAAd,EAC1B,CAvpBkB,OAgqBnBC,aAhqBmB,CAgqBH,SAACC,GAAD,CAAMC,eAAN,CAA2B,CACzC,GAAIC,UAAS,CAAG,MAAKf,KAAL,CAAWC,OAA3B,CAGAe,KAAK,CAACC,IAAN,CAAW,MAAKzC,KAAL,CAAW+B,MAAtB,EAA8BM,GAA9B,CAAkC,SAAClC,KAAD,CAAQyB,CAAR,CAAc,CAC9C,GAAIc,GAAE,CAAEvC,KAAK,CAACC,QAAd,CACA,GAAIuC,IAAG,CAAG,EAAV,CACA,GAAId,OAAJ,CACA;AACA,GAAI,CAACS,eAAe,CAACM,GAAhB,CAAoBF,EAApB,CAAL,CAA8B,CAE1B,GAAI,MAAK1C,KAAL,CAAWiB,aAAX,CAAyBL,IAAzB,EAAiC,aAAjC,EAAkD,MAAKZ,KAAL,CAAWiB,aAAX,CAAyBL,IAAzB,EAAiC,MAAKY,KAAL,CAAWP,aAAlG,CAAiH,CAC/G0B,GAAG,CAAGlF,UAAN,CACD,CAFD,IAEO,CACLkF,GAAG,CAAGpF,aAAN,CACD,CACCsE,MAAM,CAAG3E,YAAY,CAAC0E,CAAD,CAAIzB,KAAK,CAAC0C,QAAN,CAAeC,QAAnB,CAA6BT,GAA7B,CAAkClC,KAAK,CAAC4C,IAAxC,CAA8CJ,GAA9C,CAArB,CACAJ,SAAS,CAACP,GAAV,CAAcU,EAAd,CAAkB,CAACb,MAAM,CAAEA,MAAT,CAAiB1B,KAAK,CAAEA,KAAxB,CAAlB,EACL,CACF,CAfD,EAgBF,MAAKK,QAAL,CAAc,CAAEiB,OAAO,CAAGc,SAAZ,CAAd,EACA,MAAKS,gBAAL,CAAsBX,GAAtB,EACD,CAtrBoB,OAwrBrBW,gBAxrBqB,CAwrBF,SAACX,GAAD,QAASG,MAAK,CAACC,IAAN,CAAW,MAAKjB,KAAL,CAAWC,OAAtB,CAA+B,eAAmB,mCAAjBwB,GAAiB,UAAZC,KAAY,UAE5E;AACAA,KAAK,CAACrB,MAAN,CAAasB,WAAb,CAAyB,OAAzB,CAAmC,UAAM,CACpC,MAAKC,mBAAL,CAAyBF,KAAK,CAAC/C,KAA/B,EACC,MAAKkD,kBAAL,CAAwB,UAAM,CAC5BzD,UAAU,CAAC0D,UAAX,CAAsBhH,cAAc,CAACiH,oBAAf,CAAoC,MAAKC,cAAL,CAAoBN,KAAK,CAAC/C,KAA1B,CAApC,CAAtB,EACAP,UAAU,CAACiC,MAAX,CAAoBqB,KAApB,CACAtD,UAAU,CAAC6D,IAAX,CAAgBpB,GAAhB,CAAqBa,KAAK,CAACrB,MAA3B,EACD,CAJD,EAKA,CAPN,EAQD,CAX2B,CAAT,EAxrBE,OA6tBrB6B,eA7tBqB,CA6tBH,SAACrB,GAAD,CAAMjC,QAAN,CAAgBuD,QAAhB,CAA6B,CAC7C,GAAIC,QAAO,CAAG,GAAI9G,OAAM,CAAC+C,IAAP,CAAYkC,MAAZ,CAAmB8B,aAAvB,CAAqCxB,GAArC,CAAd,CACA,GAAIyB,QAAO,CAAG,CACZC,OAAO,CAAE3D,QADG,CAEZ4D,MAAM,CAAE,CAAC,IAAD,CAAO,MAAP,CAAe,MAAf,CAAuB,mBAAvB,CAA4C,SAA5C,CAFI,CAAd,CAKG;AACDJ,OAAO,CAACK,UAAR,CAAmBH,OAAnB,CAA4B,SAAC3D,KAAD,CAAQ+D,MAAR,CAAmB,CAC7C,GAAIA,MAAM,GAAKpH,MAAM,CAAC+C,IAAP,CAAYkC,MAAZ,CAAmBoC,mBAAnB,CAAuCC,EAAtD,CAA0D,CACxDT,QAAQ,CAACxD,KAAD,CAAR,CACD,CAFD,IAEO,CACLkE,OAAO,CAACC,KAAR,CAAc,OAAd,CAAuBJ,MAAvB,EACD,CACF,CAND,EAOH,CA5uBoB,OA8uBrBK,OA9uBqB,CA8uBX,SAACC,aAAD,CAAmB,CAC3B,GAAIA,aAAa,GAAKlE,SAAtB,CACE,MAAO,SAAP,CADF,IAEK,CACH,GAAImE,OAAM,CAAID,aAAa,CAACE,OAAf,CAA0B,KAA1B,CAAkC,IAA/C,CACA,MAAOD,OAAP,CACD,CACF,CArvBoB,OAuvBrBE,YAvvBqB,CAuvBN,SAAC9C,MAAD,CAAY,CACzB,GAAIA,MAAM,EAAIvB,SAAd,CACE,OAEF,GAAIqC,IAAG,CAAG,EAAV,CACA,GAAId,MAAM,CAAC1B,KAAP,CAAaC,QAAb,EAAyB,MAAKJ,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyBC,QAAtD,CAAgE,CAC9DuC,GAAG,CAAGrF,WAAN,CACD,CAFD,IAGK,IAAIuE,MAAM,CAACzB,QAAP,GAAoB,MAAKJ,KAAL,CAAW4E,YAAX,CAAwBxE,QAAhD,CAA0D,CAC7DuC,GAAG,CAAGnF,YAAN,CACD,CAFI,IAEE,IAAI,MAAKwC,KAAL,CAAWiB,aAAX,CAAyBL,IAAzB,EAAiC,aAAjC,EAAkD,MAAKZ,KAAL,CAAWiB,aAAX,CAAyBL,IAAzB,EAAiC,MAAKY,KAAL,CAAWP,aAAlG,CAAgH,CACrH0B,GAAG,CAAGlF,UAAN,CACD,CAFM,IAEA,CACLkF,GAAG,CAAGpF,aAAN,CACD,CACDsE,MAAM,CAACA,MAAP,CAAcgD,OAAd,CAAsBlC,GAAtB,EACD,CAvwBoB,OAywBrBmC,YAzwBqB,CAywBN,SAACC,OAAD,CAAa,CAC1B,GAAIA,OAAJ,CAAa,CACX,MAAKC,iBAAL,GACD,CAFD,IAEO,CACL,MAAKC,gBAAL,GACD,CACF,CA/wBoB,OAixBrBC,YAjxBqB,CAixBN,SAACH,OAAD,CAAa,CAC1B,GAAIA,OAAJ,CAAa,CACX,MAAKvE,QAAL,CAAc,CAAE2B,QAAQ,CAAG,IAAb,CAAd,EACD,CAFD,IAEO,CACL,MAAK3B,QAAL,CAAc,CAAE2B,QAAQ,CAAG,KAAb,CAAd,EACD,CACF,CAvxBoB,OAyxBrBgD,YAzxBqB,CAyxBN,SAACC,KAAD,CAAW,CACxB,MAAK5E,QAAL,CAAc,CAAE0B,MAAM,CAAGkD,KAAK,CAAClD,MAAjB,CAAd,EACD,CA3xBoB,OA8xBrBmD,sBA9xBqB,6FA8xBI,kBAAOC,cAAP,wHACvB,MAAKtF,KAAL,CAAWqF,sBAAX,CAAkCC,cAAlC,EADuB,wDA9xBJ,uEAkyBrBC,iBAlyBqB,wEAkyBD,mJACd3E,IADc,CACP,gBADO,CAElB7E,SAAS,CAAC,MAAKiE,KAAL,CAAWE,OAAZ,CAAqBU,IAArB,6FAA2B,kBAAO4E,IAAP,CAAaC,KAAb,oMAChC;AADgC,qCAEdD,IAFc,MAEhC,+CAAwB,CAAfrF,KAAe,aACtB,GAAI,CAAC,MAAKqB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B/E,IAA5B,EAAkCgC,GAAlC,CAAsCzC,KAAK,CAACC,QAA5C,CAAL,CAA4D,CAC1D,MAAKoB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B/E,IAA5B,EAAkCoB,GAAlC,CAAsC7B,KAAK,CAACC,QAA5C,CAAsDD,KAAtD,EACD,CACF,CAN+B,qDAOhC,MAAKqB,KAAL,CAAWoE,YAAX,CAAwB5D,GAAxB,CAA4BpB,IAA5B,CAAkC6E,KAAlC,EACII,YAR4B,CAQb,EARa,CAShCrD,KAAK,CAACC,IAAN,CAAW,MAAKjB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B/E,IAA5B,EAAkCkF,OAAlC,EAAX,EAAwDzD,GAAxD,CAA4D,eAAeT,CAAf,CAAqB,mCAAnBqB,GAAmB,UAAdC,KAAc,UAC/E,GAAKtB,CAAC,CAAG,CAAT,CAAY,OACZiE,YAAY,CAACE,IAAb,CAAkB7C,KAAK,CAACL,QAAN,CAAeC,QAAjC,EACD,CAHD,EATgC,uBAcR5D,gBAAe,CAAC2G,YAAD,CAdP,QAc5BG,WAd4B,gBAehC;AACAA,WAAW,CAACtE,OAAZ,CAAoB,SAAAC,CAAC,CAAI,CACvB,GAAIsE,KAAI,CAAEC,QAAQ,CAAC,MAAKlG,KAAL,CAAWE,OAAX,CAAmBiG,MAAnB,CAA0BC,GAA3B,CAAgC,MAAKpG,KAAL,CAAWE,OAAX,CAAmBiG,MAAnB,CAA0BE,GAA1D,CAChB1E,CAAC,CAAC6D,IAAF,CAAOc,KADS,CACF3E,CAAC,CAAC6D,IAAF,CAAOe,KADL,CAAlB,CAEE5E,CAAC,CAACuE,QAAF,CAAaD,IAAb,CACH,CAJD,EAMAD,WAAW,CAACQ,IAAZ,CAAiB,SAACC,CAAD,CAAIC,CAAJ,CAAU,CACzB,GAAID,CAAC,CAACP,QAAF,CAAaQ,CAAC,CAACR,QAAnB,CAA6B,CAC3B,MAAO,CAAC,CAAR,CACD,CACD,GAAIO,CAAC,CAACP,QAAF,CAAaQ,CAAC,CAACR,QAAnB,CAA6B,CAC3B,MAAO,EAAP,CACD,CACD,MAAO,EAAP,CACD,CARD,EAUMS,YAhC0B,CAgCXC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAe,MAAK9G,KAAL,CAAWsF,cAA1B,CAAX,CAhCW,CAiC9B,GAAIqB,YAAY,EAAI,EAApB,CAAwB,CAAEA,YAAY,CAAG,EAAf,CAAkB,CAE5C;AACII,SApC0B,CAoCd,GAAIxF,IAAJ,EApCc,CAqC9B,IAASK,CAAT,CAAW,CAAX,CAAcA,CAAC,CAAEoE,WAAW,CAACzF,MAA7B,CAAqCqB,CAAC,EAAtC,CAA0C,CACxC,GAAI,CAACmF,SAAS,CAACnE,GAAV,CAAcoD,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,CAAL,CAAyC,CACvCgE,SAAS,CAAC/E,GAAV,CAAcgE,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,CAAmCiD,WAAW,CAACpE,CAAD,CAAX,CAAe4D,IAAlD,EACD,CAFD,IAEO,CACL;AACA,GAAIuB,SAAS,CAACpB,GAAV,CAAcK,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,EAAmCiE,WAAnC,EAAkDhB,WAAW,CAACpE,CAAD,CAAX,CAAe4D,IAAf,CAAoBwB,WAA1E,CAAuF,CACrFD,SAAS,CAAC/E,GAAV,CAAcgE,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,gCACMgE,SAAS,CAACpB,GAAV,CAAcK,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,CADN,MAEIkE,OAAO,CAAGF,SAAS,CAACpB,GAAV,CAAcK,WAAW,CAACpE,CAAD,CAAX,CAAemB,IAA7B,EAAmCkE,OAAnC,CAA4C,GAA5C,CAAiDjB,WAAW,CAACpE,CAAD,CAAX,CAAe4D,IAAf,CAAoByB,OAFnF,IAID,CACF,CACF,CACDN,YAAY,CAACO,OAAb,CAAuBH,SAAvB,CAlD8B,wBAmDxB,OAAK1B,sBAAL,CAA4BsB,YAA5B,CAnDwB,0DAA3B,qEAAT,CAFkB,wDAlyBC,SA41BrBQ,eA51BqB,CA41BH,UAAM,CACtB,GAAIC,GAAE,CAAG,GAAItK,OAAM,CAAC+C,IAAP,CAAYwH,iBAAhB,EAAT,CACD;AACA,GAAIC,SAAQ,CAAG,GAAKxK,OAAM,CAAC+C,IAAP,CAAY0H,kBAAjB,CAAoCC,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CAApC,CAAqE,CAACC,QAAQ,CAAE,MAAK1H,KAAL,CAAWkC,MAAtB,CAArE,CAAf,CAEGkF,EAAE,CAACO,WAAH,CAAe,CACX7E,QAAQ,CAAE,MAAK9C,KAAL,CAAWkC,MADV,CAEX0F,MAAM,CAAE,EAFG,CAAf,CAGG,SAACpC,IAAD,CAAOtB,MAAP,CAAkB,CACnB,GAAIA,MAAM,GAAKpH,MAAM,CAAC+C,IAAP,CAAYgI,gBAAZ,CAA6BzD,EAA5C,CAAgD,CAE5C,GAAI0D,YAAW,CAAG,GAAIhL,OAAM,CAAC+C,IAAP,CAAYkI,MAAhB,CAAuB,CACrCL,QAAQ,CAAE,MAAK1H,KAAL,CAAWkC,MADgB,CAErCG,GAAG,CAAEiF,QAFgC,CAAvB,CAAlB,CAKA,GAAIU,QAAO,CAAGlL,MAAM,CAAC+C,IAAP,CAAYgD,QAAZ,CAAqBoF,SAArB,CAA+BC,cAA/B,CAA8C1C,IAAI,CAAC1C,QAAL,CAAcqF,MAA5D,CAAoEL,WAAW,CAACM,WAAZ,EAApE,CAAd,CAEAd,QAAQ,CAACe,MAAT,CAAgB,CACZL,OAAO,CAAEA,OADG,CAEZM,KAAK,CAAE,CAFK,CAAhB,EAIA,MAAK9H,QAAL,CAAc,CAACwH,OAAO,CAAEA,OAAV,CAAd,EACH,CACJ,CAnBC,EAoBH,CAr3BoB,OAw3BrBO,iBAx3BqB,CAw3BD,UAAM,CACxB,GAAIC,IAAG,CAAG,YAAc,MAAKhH,KAAL,CAAWd,OAAX,CAAmB+H,SAA3C,CACA,MAAKzI,KAAL,CAAW0I,OAAX,CAAmB3C,IAAnB,CAAwByC,GAAxB,EACD,CA33BoB,OA63BrBG,WA73BqB,CA63BP,UAAM,CAClB,MAAKnI,QAAL,CAAc,CAAEoI,SAAS,CAAG,CAAC,MAAKpH,KAAL,CAAWoH,SAA1B,CAAd,EACD,CA/3BoB,CAEjB,MAAKC,KAAL,cAAajN,KAAK,CAACkN,SAAN,EAAb,CACA,MAAKC,UAAL,cAAkBnN,KAAK,CAACkN,SAAN,EAAlB,CACA,MAAKlF,OAAL,CAAe,GAAI9G,OAAM,CAAC+C,IAAP,CAAYwH,iBAAhB,EAAf,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAK7F,KAAL,CAAa,CACXU,MAAM,CAAE,MAAKlC,KAAL,CAAWkC,MADR,CAEXG,GAAG,CAAG/B,SAFK,CAGXmB,OAAO,CAAG,GAAIF,IAAJ,EAHC,CAIXyH,aAAa,CAAG,GAAIzH,IAAJ,EAJL,CAKX0H,YAAY,CAAG,GAAI1H,IAAJ,EALJ,CAMXmE,YAAY,CAAG,GAAInE,IAAJ,EANJ,CAOXqE,YAAY,CAAG,GAAIrE,IAAJ,EAPJ,CAQXR,YAAY,CAAG,EARJ,CASXmI,YAAY,CAAG,MAAKlJ,KAAL,CAAWE,OAAX,CAAmBiJ,MAAnB,CAA4B,IAA5B,CAAmC,MAAKnJ,KAAL,CAAWE,OAAX,CAAmBkJ,IAAtD,CAA6D,GAA7D,CAAmE,MAAKpJ,KAAL,CAAWE,OAAX,CAAmBsB,KAAtF,CAA8F,IAA9F,CAAqG,MAAKxB,KAAL,CAAWE,OAAX,CAAmBmJ,GAT5H,CAUXC,UAAU,CAAG5M,SAAS,CAAC,MAAKsD,KAAL,CAAWkC,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAVX,CAWXqH,WAAW,CAAG,EAXH,CAYXC,mBAAmB,CAAE,IAZV,CAaXvI,aAAa,CAAE,EAbJ,CAaQ;AACnBwI,iBAAiB,CAAG,KAdT,CAeXzI,GAAG,CAAG,MAfK,CAgBXE,oBAAoB,CAAE,EAhBX,CAgBe;AAC1BwI,MAAM,CAAG,IAjBE,CAkBXC,IAAI,CAAG,MAAK3J,KAAL,CAAW2J,IAlBP,CAmBXxH,QAAQ,CAAE,KAnBC,CAoBXyH,OAAO,CAAG9M,MAAM,CAAC+C,IAAP,CAAYgK,SAAZ,CAAsBC,SApBrB,CAqBXC,WAAW,+CAAKpN,GAAL,CAAY,IAAZ,+BAAmBC,UAAnB,CAAiC,IAAjC,eArBA,CAsBXoN,UAAU,CAAG,CACXC,iBAAiB,CAAE,IADR,CAEXC,YAAY,CAAE,IAFH,CAGXC,iBAAiB,CAAE,KAHR,CAIXC,MAAM,CAAE,CAAC,CACLC,WAAW,CAAE,cADR,CAELC,WAAW,CAAE,QAFR,CAGLC,OAAO,CAAE,CAAC,CACNC,UAAU,CAAE,KADN,CAAD,CAHJ,CAAD,CAJG,CAWXC,eAAe,CAAE,QAXN,CAYXC,sBAAsB,CAAE,IAZb,CAaXC,OAAO,CAAE,CAbE,CAcXC,OAAO,CAAE,GAdE,CAeXC,cAAc,CAAE,IAfL,CAgBXC,SAAS,CAAEhO,MAAM,CAAC+C,IAAP,CAAYgK,SAAZ,CAAsBkB,OAhBtB,CAiBXC,qBAAqB,CAAE,CACnBC,KAAK,CAAEnO,MAAM,CAAC+C,IAAP,CAAYqL,mBAAZ,CAAgCC,cADpB,CAEnBzD,QAAQ,CAAE5K,MAAM,CAAC+C,IAAP,CAAYuL,eAAZ,CAA4BC,aAFnB,CAGnBC,UAAU,CAAE,CACVxO,MAAM,CAAC+C,IAAP,CAAYgK,SAAZ,CAAsBkB,OADZ,CAEVjO,MAAM,CAAC+C,IAAP,CAAYgK,SAAZ,CAAsBC,SAFZ,CAGVhN,MAAM,CAAC+C,IAAP,CAAYgK,SAAZ,CAAsB0B,MAHZ,CAHO,CAjBZ,CA0BXC,WAAW,CAAE,IA1BF,CA2BXC,cAAc,CAAE,KA3BL,CAtBF,CAoDX7C,SAAS,CAAG,KApDD,CAAb,CAuDA,MAAKzH,cAAL,CAAsB,MAAKA,cAAL,CAAoBuK,IAApB,+BAAtB,CACA,MAAKtI,mBAAL,CAA2B,MAAKA,mBAAL,CAAyBsI,IAAzB,+BAA3B,CACA,MAAKC,aAAL,CAAqB,MAAKA,aAAL,CAAmBD,IAAnB,+BAArB,CACA,MAAKE,UAAL,CAAkB,MAAKA,UAAL,CAAgBF,IAAhB,+BAAlB,CACA,MAAKG,aAAL,CAAqB,MAAKA,aAAL,CAAmBH,IAAnB,+BAArB,CACA,MAAKI,cAAL,CAAsB,MAAKA,cAAL,CAAoBJ,IAApB,+BAAtB,CACA,MAAKK,iBAAL,CAAyB,MAAKA,iBAAL,CAAuBL,IAAvB,+BAAzB,CACA,MAAKM,UAAL,cAAkBpQ,KAAK,CAACkN,SAAN,EAAlB,CACA,MAAK1G,aAAL,CAAqB,MAAKA,aAAL,CAAmBsJ,IAAnB,+BAArB,CACA,MAAK/G,YAAL,CAAoB,MAAKA,YAAL,CAAkB+G,IAAlB,+BAApB,CACA,MAAK1I,gBAAL,CAAwB,MAAKA,gBAAL,CAAsB0I,IAAtB,+BAAxB,CACA,MAAKO,OAAL,CAAgB,MAAK1H,OAAL,CAAamH,IAAb,+BAAhB,CACA,MAAKhI,eAAL,CAAuB,MAAKA,eAAL,CAAqBgI,IAArB,+BAAvB,CACA,MAAKrI,kBAAL,CAA0B,MAAKA,kBAAL,CAAwBqI,IAAxB,+BAA1B,CACA,MAAKQ,oBAAL,CAA4B,MAAKA,oBAAL,CAA0BR,IAA1B,+BAA5B,CACA,MAAKS,kBAAL,CAA0B,MAAKA,kBAAL,CAAwBT,IAAxB,+BAA1B,CACA,MAAK1G,iBAAL,CAAyB,MAAKA,iBAAL,CAAuB0G,IAAvB,+BAAzB,CACA,MAAKlI,cAAL,CAAsB,MAAKA,cAAL,CAAoBkI,IAApB,+BAAtB,CACA,MAAK5G,YAAL,CAAoB,MAAKA,YAAL,CAAkB4G,IAAlB,+BAApB,CACA,MAAKzG,gBAAL,CAAwB,MAAKA,gBAAL,CAAsByG,IAAtB,+BAAxB,CACA,MAAKU,mBAAL,CAA2B,MAAKA,mBAAL,CAAyBV,IAAzB,+BAA3B,CACA,MAAKW,WAAL,CAAkB,MAAKA,WAAL,CAAiBX,IAAjB,+BAAlB,CACA,MAAKY,SAAL,CAAiB,MAAKA,SAAL,CAAeZ,IAAf,+BAAjB,CACA,MAAKa,uBAAL,CAA+B,MAAKA,uBAAL,CAA6Bb,IAA7B,+BAA/B,CACA,MAAKc,wBAAL,CAAgC,MAAKA,wBAAL,CAA8Bd,IAA9B,+BAAhC,CACA,MAAKvG,YAAL,CAAoB,MAAKA,YAAL,CAAkBuG,IAAlB,+BAApB,CACA,MAAKe,eAAL,CAAuB,MAAKA,eAAL,CAAqBf,IAArB,+BAAvB,CAEA;AACAgB,WAAW,wEAAC,0JACJC,OADI,CACO/M,UAAU,CAACgN,MAAX,GAAsB,IAAtB,CAA6B,KADpC,CAER,GAAI,CAACD,OAAD,EAAY/M,UAAU,CAACiC,MAAX,EAAqBvB,SAAjC,EAA8CV,UAAU,CAACiC,MAAX,CAAkBoB,GAAlB,EAAyB,eAA3E,CAA4F,CACtFN,GADsF,CAChF,EADgF,CAE1F,GAAI/C,UAAU,CAACiC,MAAX,CAAkB1B,KAAlB,CAAwBC,QAAxB,EAAoC,MAAKJ,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyBC,QAAjE,CAA2E,CACzEuC,GAAG,CAAGrF,WAAN,CACD,CAFD,IAGK,IAAI,MAAK0C,KAAL,CAAWiB,aAAX,CAAyBL,IAAzB,EAAiC,aAAjC,EAAkDhB,UAAU,CAACiC,MAAX,CAAkB1B,KAAlB,CAAwB0M,KAAxB,CAA8BC,QAA9B,CAAuC,MAAK9M,KAAL,CAAWiB,aAAX,CAAyBL,IAAhE,CAAtD,CAA6H,CAChI+B,GAAG,CAAGlF,UAAN,CACD,CAFI,IAEE,CACLkF,GAAG,CAAGpF,aAAN,CACD,CACDqC,UAAU,CAACiC,MAAX,CAAkBA,MAAlB,CAAyBgD,OAAzB,CAAiClC,GAAjC,EACA,MAAKS,mBAAL,CAAyB,KAAzB,EACD,CAdO,wDAAD,GAeR,GAfQ,CAAX,CAlGiB,aAkHlB,C,mJAED,0IACE2J,MAAM,CAACC,QAAP,CAAgB,CAAEC,GAAG,CAAE,CAAP,CAAUC,QAAQ,CAAE,QAApB,CAAhB,EACA,KAAKZ,SAAL,GAFF,uBAGQ,MAAKrM,WAAL,EAHR,QAKE;AACA,GAAI,KAAKD,KAAL,CAAWmN,eAAf,CAAgC,CAC9B,KAAKnN,KAAL,CAAWoN,iBAAX,CAA6B,KAA7B,EACA,GAAIL,MAAM,CAACM,UAAP,CAAoB,GAAxB,CAA6B,CAC3B,KAAKrN,KAAL,CAAWsN,kBAAX,GACD,CACF,CAXH,6D,iJAcA,+BAAuB,CACrB,KAAKnM,cAAL,CAAoB,EAApB,EACD,C,+HAED,kBAAyBoM,SAAzB,CAAoCC,SAApC,gNACE;AACA,GAAI,KAAKxN,KAAL,CAAW4E,YAAX,EAA2B,KAAK5E,KAAL,CAAW4E,YAAX,GAA4B2I,SAAS,CAAC3I,YAArE,CACE,GAAI,KAAK5E,KAAL,CAAW4E,YAAX,CAAwB6I,QAAxB,GAAmClN,MAAnC,CAA4C,CAAhD,CAAmD,CACjD,KAAKC,QAAL,CAAc,CAAC0B,MAAM,CAAG,KAAKlC,KAAL,CAAW4E,YAAX,CAAwB/B,QAAxB,CAAiCC,QAA3C,CAAd,EACA;AACA,GAAIyK,SAAS,CAAC3I,YAAV,CAAuB6I,QAAvB,GAAkClN,MAAlC,CAA2C,CAA/C,CAAkD,CAChD,KAAKoE,YAAL,CAAkB,KAAKnD,KAAL,CAAWC,OAAX,CAAmBkE,GAAnB,CAAuB4H,SAAS,CAAC3I,YAAV,CAAuBxE,QAA9C,CAAlB,EACD,CACD,KAAKoB,KAAL,CAAWC,OAAX,CAAmBkE,GAAnB,CAAuB,KAAK3F,KAAL,CAAW4E,YAAX,CAAwBxE,QAA/C,EAAyDyB,MAAzD,CAAgEgD,OAAhE,CAAwErH,YAAxE,EACAV,MAAM,CAAC+C,IAAP,CAAYuF,KAAZ,CAAkBsI,OAAlB,CAA0B,KAAKlM,KAAL,CAAWC,OAAX,CAAmBkE,GAAnB,CAAuB,KAAK3F,KAAL,CAAW4E,YAAX,CAAwBxE,QAA/C,EAAyDyB,MAAnF,CAA2F,OAA3F,EACD,CAEH;AACA,GAAI,KAAK7B,KAAL,CAAW+B,MAAX,GAAsBwL,SAAS,CAACxL,MAAhC,EAA0C,EAAE,CAAC,KAAKP,KAAL,CAAWW,QAAZ,EAAwBqL,SAAS,CAACrL,QAApC,CAA9C,CAA6F,CAC3F,GAAI,KAAKX,KAAL,CAAWa,GAAX,EAAkB/B,SAAtB,CAAiC,CAC3BqN,WAD2B,CACZnL,KAAK,CAACC,IAAN,CAAW,KAAKjB,KAAL,CAAWC,OAAX,CAAmBmM,MAAnB,EAAX,CADY,CAE3BC,iBAF2B,CAEP,EAFO,CAG3BvL,eAH2B,CAGT,GAAIf,IAAJ,EAHS,CAK/B,GAAIgM,SAAS,CAACxL,MAAV,CAAiBxB,MAAjB,CAA0B,KAAKP,KAAL,CAAW+B,MAAX,CAAkBxB,MAAhD,CAAwD,CACtDsN,iBAAiB,CAAGF,WAAW,CAACG,KAAZ,CAAkB,KAAK9N,KAAL,CAAW+B,MAAX,CAAkBxB,MAApC,CAA4CgN,SAAS,CAACxL,MAAV,CAAiBxB,MAA7D,CAApB,CACAoN,WAAW,CAACG,KAAZ,CAAkB,CAAlB,CAAqB,KAAK9N,KAAL,CAAWO,MAAhC,EAAwCmB,OAAxC,CAAgD,SAAAqM,CAAC,QAAIzL,gBAAe,CAACN,GAAhB,CAAoB+L,CAAC,CAAC3N,QAAtB,CAAgC,CAAhC,CAAJ,EAAjD,EAAyF;AAC1F,CAHD,IAIK,IAAImN,SAAS,CAACxL,MAAV,CAAiBxB,MAAjB,CAA0B,KAAKP,KAAL,CAAW+B,MAAX,CAAkBxB,MAAhD,CAAwD,CAEvDyN,GAFuD,CAEjDL,WAAW,CAACG,KAAZ,CAAkB,CAAlB,CAAqBP,SAAS,CAACxL,MAAV,CAAiBxB,MAAtC,CAFiD,CAG3DyN,GAAG,CAACtM,OAAJ,CAAY,SAAAqM,CAAC,QAAIzL,gBAAe,CAACN,GAAhB,CAAoB+L,CAAC,CAAC3N,QAAtB,CAAgC,CAAhC,CAAJ,EAAb,EACD,CAJI,IAIE,CACL,KAAKgB,YAAL,GACD,CAED;AACAyM,iBAAiB,CAACnM,OAAlB,CAA0B,SAAAqM,CAAC,QAAIA,EAAC,CAAClM,MAAF,CAASC,MAAT,CAAgB,IAAhB,CAAJ,EAA3B,EAEA;AACA,KAAKM,aAAL,CAAmB,KAAKZ,KAAL,CAAWa,GAA9B,CAAmCC,eAAnC,EACD,CACF,CAED;AAxCF,KAyCM,KAAKd,KAAL,CAAWa,GAAX,GAAmB/B,SAzCzB,gCA0CQ,KAAKN,KAAL,CAAWiO,UAAX,GAA0BV,SAAS,CAACU,UA1C5C,+BA2CU,KAAKzM,KAAL,CAAWgI,mBA3CrB,iDA4Cc,MAAKxE,iBAAL,EA5Cd,QAgDE;AACA,GAAIuI,SAAS,CAACrN,OAAV,EAAqB,KAAKF,KAAL,CAAWE,OAApC,CAA6C,CAC3C,KAAKkB,YAAL,GACA,KAAKnB,WAAL,GACJ;AAEG,CAED;AAxDF,KAyDMsN,SAAS,CAACjI,cAAV,CAAyB4I,WAAzB,EAAwC,KAAKlO,KAAL,CAAWsF,cAAX,CAA0B4I,WAzDxE,oDA0DU,MAAK3I,iBAAL,EA1DV,SA2DI,KAAK5E,qBAAL,CAA2B,gBAA3B,CAA6C,gBAA7C,CAA+D,CAA/D,EA3DJ,QA+DE;AACA,GAAI4M,SAAS,CAACtM,aAAV,EAA2B,KAAKjB,KAAL,CAAWiB,aAA1C,CAAyD,CAEnDkN,YAFmD,CAEpC,KAAKnO,KAAL,CAAWiB,aAAX,CAAyBL,IAFW,CAGnDA,IAHmD,CAG5C,KAAKZ,KAAL,CAAWiB,aAAX,CAAyBL,IAHmB,CAInDwN,eAJmD,CAIjCxN,IAAI,CAACyN,OAAL,CAAa,IAAb,CAAmB,GAAnB,CAJiC,CAKvD,GAAIzN,IAAI,EAAI,SAAZ,CAAuBA,IAAI,CAAG,iBAAP,CAAvB,IACK,IAAIuN,YAAY,EAAI,aAApB,CAAmC,CACtCA,YAAY,CAAG,eAAf,CACAC,eAAe,CAAG,KAAlB,CACD,CACH;AACE,KAAKhN,YAAL,GACA,KAAKgB,aAAL,CAAmB,KAAKZ,KAAL,CAAWa,GAA9B,CAAmC,GAAId,IAAJ,EAAnC,EACD,CAED;AACA,GAAIgM,SAAS,CAACe,KAAV,CAAgBjF,GAAhB,GAAwB,KAAKrJ,KAAL,CAAWsO,KAAX,CAAiBjF,GAA7C,CAAkD,CAChD,KAAK8C,kBAAL,GACD,CAED;AACA,GAAIoB,SAAS,CAACe,KAAV,CAAgBC,SAAhB,GAA8B,KAAKvO,KAAL,CAAWsO,KAAX,CAAiBC,SAAnD,CAA8D,CAC5D,KAAK/B,wBAAL,GACD,CAvFH,8D,8JAkGA,iCAAwBgC,gBAAxB,CAA0C,CACxC,KAAKxO,KAAL,CAAWuM,uBAAX,CAAmCiC,gBAAnC,EACD,C,+HAED,qKACM,KAAKxO,KAAL,CAAWE,OAAX,CAAmBmJ,GAAnB,EAA0B/I,SADhC,oEAEQmO,YAFR,CAEuBC,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkB,KAAKnN,KAAL,CAAW+H,WAA7B,CAFvB,CAGQ/D,IAHR,CAGe,CAAC,KAAKxF,KAAL,CAAWsO,KAAX,CAAiBjF,GAAlB,CAHf,CAIIoF,YAAY,CAACpF,GAAb,CAAmB7D,IAAnB,CAEA,KAAKhF,QAAL,CAAc,CAAC+I,WAAW,CAAGkF,YAAf,CAA6B1E,WAAW,gCAAO,KAAKvI,KAAL,CAAWuI,WAAlB,wBAAgCpN,GAAhC,CAAsC,KAAtC,EAAxC,CAAd,EACA;AACA,KAAKqI,iBAAL,GARJ,6D,2PAWA,qKACE;AACIQ,IAFN,CAEc,KAAKxF,KAAL,CAAWsO,KAAX,CAAiBC,SAAjB,CAA2BK,UAFzC,CAIMH,YAJN,CAIqBC,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkB,KAAKnN,KAAL,CAAW+H,WAA7B,CAJrB,CAKEkF,YAAY,CAACF,SAAb,CAAyB/I,IAAzB,CALF,wBAMQ,MAAKhF,QAAL,CAAc,CAAE+I,WAAW,CAAGkF,YAAhB,CAA8BhF,iBAAiB,CAAG,IAAlD,CAAwDM,WAAW,gCAAO,KAAKvI,KAAL,CAAWuI,WAAlB,wBAAgCnN,UAAhC,CAA8C,KAA9C,EAAnE,CAAd,CANR,QAOE,KAAKoI,iBAAL,GAPF,+D,2JAYA,oBAAY,2CACQjI,cAAc,CAAC8R,MAAf,CAAsB7R,SAAtB,EAAiC6R,MAAjC,CAAwC,CAAC,eAAD,CAAxC,CADR,aACT,kDAA6E,IAApEjO,KAAoE,cAC3E,GAAIA,IAAI,EAAI,iBAAZ,CAA+BA,IAAI,CAAG,SAAP,CAC/B,KAAKY,KAAL,CAAWkE,YAAX,CAAwB1D,GAAxB,CAA4BpB,IAA5B,CAAkC,GAAIW,IAAJ,EAAlC,EACD,CAJQ,uDAKX,C,gCAED,2BAAmB,iBACjB,GAAI,KAAKC,KAAL,CAAWa,GAAf,CACA,KAAKb,KAAL,CAAWa,GAAX,CAAemD,IAAf,CAAoB9D,OAApB,CAA4B,SAACoN,OAAD,CAAa,CACvC,MAAI,CAACtN,KAAL,CAAWa,GAAX,CAAemD,IAAf,CAAoBuJ,MAApB,CAA2BD,OAA3B,EACD,CAFD,EAGD,C,iCAED,4BAAoB,iBAClB;AACE,KAAK7J,gBAAL,GACA;AACA,GAAI,KAAKjF,KAAL,CAAWiO,UAAX,EAAyBtR,GAA7B,CAAkC,CAChC,GAAI,KAAK6E,KAAL,CAAW+H,WAAX,CAAuBF,GAAvB,GAA+B/I,SAA/B,EAA4C,KAAKkB,KAAL,CAAWa,GAA3D,CAAgE,CAC9D,KAAKb,KAAL,CAAW+H,WAAX,CAAuBF,GAAvB,CAA2B3H,OAA3B,CAAmC,SAAAsN,UAAU,QAAI,OAAI,CAACxN,KAAL,CAAWa,GAAX,CAAemD,IAAf,CAAoByJ,UAApB,CAA+BD,UAA/B,CAAJ,EAA7C,EACD,CAFD,IAEO,CACLE,UAAU,CAAC,iBAAM,OAAI,CAAClK,iBAAL,EAAN,EAAD,CAAiC,GAAjC,CAAV,CACD,CACF,CAND,IAOK,IAAI,KAAKhF,KAAL,CAAWiO,UAAX,EAAyBrR,UAA7B,CAAyC,CAC5C,GAAI,KAAK4E,KAAL,CAAW+H,WAAX,CAAuBgF,SAAvB,GAAqCjO,SAArC,EAAkD,KAAKkB,KAAL,CAAWa,GAAjE,CAAsE,CACpE,KAAKb,KAAL,CAAW+H,WAAX,CAAuBgF,SAAvB,CAAiC7M,OAAjC,CAAyC,SAAAsN,UAAU,QAAI,OAAI,CAACxN,KAAL,CAAWa,GAAX,CAAemD,IAAf,CAAoByJ,UAApB,CAA+BD,UAA/B,CAAJ,EAAnD,EACF,CAFA,IAEM,CACLE,UAAU,CAAC,iBAAM,OAAI,CAAClK,iBAAL,EAAN,EAAD,CAAiC,GAAjC,CAAV,CACD,CACH,CACJ,C,6HAEC,6KAGM,KAAKhF,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyB0M,KAAzB,CAA+BC,QAA/B,CAAwC,eAAxC,CAHN,2BAGmE;AAC3D3M,KAJR,CAIgB,KAAKH,KAAL,CAAWE,OAAX,CAAmBC,KAJnC,yBAKU,MAAKK,QAAL,CAAc,CAAE2O,YAAY,CAAGhP,KAAjB,CAAd,CALV,QAMI,KAAKuD,eAAL,CAAqB,KAAKlC,KAAL,CAAWa,GAAhC,CAAqC,KAAKrC,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyBC,QAA9D,8FAAwE,mBAAOgP,OAAP,4HAEtEjP,KAAK,CAACkP,IAAN,CAAaD,OAAO,CAACC,IAArB,CACAlP,KAAK,CAAC4C,IAAN,CAAaqM,OAAO,CAACrM,IAArB,CACA5C,KAAK,CAACC,QAAN,CAAiBgP,OAAO,CAAC1M,EAAzB,CACA,MAAI,CAAClB,KAAL,CAAWwH,aAAX,CAAyBhH,GAAzB,CAA6B7B,KAAK,CAACuC,EAAnC,CAAuC0M,OAAvC,EALsE,0DAAxE,mEANJ,+D,0IA0CA,uBAAcxO,IAAd,CAAoBE,KAApB,CAA2B,iBAEzB,GAAIwO,cAAa,CAAG9M,KAAK,CAACC,IAAN,CAAW,KAAKjB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B/E,IAA5B,EAAkCgN,MAAlC,EAAX,CAApB,CACA,GAAI0B,aAAa,CAAC/O,MAAd,EAAwB,CAA5B,CAA+B,CAC7B;AACAxE,SAAS,CAAC,KAAKiE,KAAL,CAAWE,OAAZ,CAAqBU,IAArB,CAA2B,SAAC4E,IAAD,CAAOC,KAAP,CAAiB,CACxD;AAEK,MAAI,CAACjF,QAAL,CAAc,CAACuB,MAAM,CAAEyD,IAAT,CAAd,EAEA;AALmD,0CAMjCA,IANiC,aAMnD,kDAAwB,IAAfrF,MAAe,cACtB,GAAI,CAAC,MAAI,CAACqB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B/E,IAA5B,EAAkCgC,GAAlC,CAAsCzC,KAAK,CAACC,QAA5C,CAAL,CAA4D,CAC1D,MAAI,CAACoB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B,MAAI,CAACnE,KAAL,CAAWP,aAAvC,EAAsDe,GAAtD,CAA0D7B,KAAK,CAACC,QAAhE,CAA0ED,KAA1E,EACD,CACF,CAVkD,uDAWjD,MAAI,CAACqB,KAAL,CAAWoE,YAAX,CAAwB5D,GAAxB,CAA4BpB,IAA5B,CAAkC6E,KAAlC,EACA,MAAI,CAACtE,cAAL,CAAoBqE,IAApB,EACD,CAbM,CAAT,CAcA;AACD,CAjBD,IAiBO,CACL,GAAI1E,KAAK,EAAIR,SAAb,CAAwB,CACtB,KAAKE,QAAL,CAAc,CAACuB,MAAM,CAAEuN,aAAa,CAACxB,KAAd,CAAoB,CAApB,CAAuB,EAAvB,CAAT,CAAd,EACA,KAAK3M,cAAL,CAAoBmO,aAAa,CAACxB,KAAd,CAAoB,CAApB,CAAsB,EAAtB,CAApB,EACD,CAHD,IAGO,CACL,KAAKtN,QAAL,CAAc,CAACuB,MAAM,CAAEuN,aAAa,CAACxB,KAAd,CAAoB,CAApB,CAAuBhN,KAAvB,CAAT,CAAd,EACA,KAAKK,cAAL,CAAoBmO,aAAa,CAACxB,KAAd,CAAoB,CAApB,CAAuBhN,KAAvB,CAApB,EACD,CACF,CACF,C,6BAED,wBAAgB,iBACd/E,SAAS,CAAC,KAAKiE,KAAL,CAAWE,OAAZ,CAAqB,eAArB,CAAsC,SAACsF,IAAD,CAAOC,KAAP,CAAiB,CAC9D,GAAI8J,WAAU,CAAG,MAAI,CAACvP,KAAL,CAAW+B,MAAX,CAAkB8M,MAAlB,CAAyBrJ,IAAzB,CAAjB,CACA,MAAI,CAAChF,QAAL,CAAc,CAACuB,MAAM,CAAEwN,UAAT,CAAd,EACA,MAAI,CAAC/O,QAAL,CAAc,CAAEO,YAAY,CAAG,EAAjB,CAAd,EACA,MAAI,CAACS,KAAL,CAAWoE,YAAX,CAAwB5D,GAAxB,CAA4B,eAA5B,CAA6CyD,KAA7C,EACA,MAAI,CAACtE,cAAL,CAAoBqE,IAApB,EACD,CANQ,CAAT,CAOD,C,8BAED,wBAAe1E,KAAf,CAAsB0O,WAAtB,CAAmC7L,QAAnC,CAA6C,iBACvC,GAAI2L,cAAa,CAAG9M,KAAK,CAACC,IAAN,CAAW,KAAKjB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B,KAAKnE,KAAL,CAAWP,aAAvC,EAAsD2M,MAAtD,EAAX,CAApB,CACA,GAAI0B,aAAa,CAAC/O,MAAd,CAAuBO,KAA3B,CAAkC,CAChC,GAAIyO,WAAU,CAAG,KAAK/N,KAAL,CAAWO,MAAX,CAAkB8M,MAAlB,CAAyBS,aAAa,CAACxB,KAAd,CAAoBhN,KAApB,CAA2BA,KAAK,CAAG,EAAnC,CAAzB,CAAjB,CACA,KAAKN,QAAL,CAAc,CAACuB,MAAM,CAAEwN,UAAT,CAAd,CAAoC,UAAM,CACxC,MAAI,CAACpO,cAAL,CAAoBoO,UAApB,EACA,GAAIC,WAAJ,CAAiB,CAAE7L,QAAQ,GAAI,CAChC,CAHD,EAID,CAND,IAMO,CACP3H,QAAQ,CAAC,KAAKwF,KAAL,CAAWoE,YAAX,CAAwBD,GAAxB,CAA4B,KAAKnE,KAAL,CAAWP,aAAvC,CAAD,CAAwD,SAACuE,IAAD,CAAOC,KAAP,CAAiB,CACjF,MAAI,CAACjE,KAAL,CAAWoE,YAAX,CAAwB5D,GAAxB,CAA4B,MAAI,CAACR,KAAL,CAAWP,aAAvC,CAAsDwE,KAAtD,EACA,GAAI8J,WAAU,CAAG,MAAI,CAACvP,KAAL,CAAW+B,MAAX,CAAkB8M,MAAlB,CAAyBrJ,IAAzB,CAAjB,CAFiF,0CAG/D+J,UAH+D,aAGjF,kDAA8B,IAArBpP,MAAqB,cAC5B,GAAI,CAAC,MAAI,CAACqB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B,MAAI,CAACnE,KAAL,CAAWP,aAAvC,EAAsD2B,GAAtD,CAA0DzC,KAAK,CAACC,QAAhE,CAAL,CAAgF,CAC9E,MAAI,CAACoB,KAAL,CAAWkE,YAAX,CAAwBC,GAAxB,CAA4B,MAAI,CAACnE,KAAL,CAAWP,aAAvC,EAAsDe,GAAtD,CAA0D7B,KAAK,CAACC,QAAhE,CAA0ED,KAA1E,EACD,CACF,CAPgF,uDAQjF,MAAI,CAACK,QAAL,CAAc,CAACuB,MAAM,CAAEwN,UAAT,CAAd,CAAoC,UAAM,CACxC,MAAI,CAACpO,cAAL,CAAoBoO,UAApB,EACA,GAAIC,WAAJ,CAAiB,CAAE7L,QAAQ,GAAI,CAChC,CAHD,EAID,CAZS,CAAR,CAaH,CACF,C,0BAED,qBAAa,CACX,GAAI,KAAK3D,KAAL,CAAW+B,MAAX,CAAkBxB,MAAlB,CAA2B,EAA/B,CAAmC,CACjC,GAAIwB,OAAM,CAAG,KAAK/B,KAAL,CAAW+B,MAAxB,CACAA,MAAM,CAAGA,MAAM,CAAC+L,KAAP,CAAa,CAAb,CAAiB/L,MAAM,CAACxB,MAAP,CAAc,EAA/B,CAAT,CACA,KAAKC,QAAL,CAAc,CAACuB,MAAM,CAAEA,MAAT,CAAd,EACA,KAAKZ,cAAL,CAAoBY,MAApB,EACD,CACF,C,mIAED,mBAA2BqD,KAA3B,qJAEMxE,IAFN,CAEawE,KAAK,CAACqK,MAAN,CAAavM,KAAb,CAAmBmL,OAAnB,CAA2B,IAA3B,CAAiC,GAAjC,CAFb,CAGE,GAAIzN,IAAI,EAAI,iBAAZ,CAA+BA,IAAI,CAAG,SAAP,CAA/B,IACK,IAAIA,IAAI,EAAI,KAAZ,CAAmBA,IAAI,CAAG,eAAP,CAExB;AANF,KAOMA,IAAI,EAAI,MAPd,4BAQI,KAAKJ,QAAL,CAAc,CAACO,YAAY,CAAG,CAAhB,CACZG,oBAAoB,CAAEkE,KAAK,CAACqK,MAAN,CAAavM,KADvB,CAEZjC,aAAa,CAAEL,IAFH,CAGZI,GAAG,CAAG,MAHM,CAAd,CAIG,iBAAM,OAAI,CAACG,cAAL,CAAoB,EAApB,CAAN,EAJH,EARJ,gCAeI,KAAKX,QAAL,CAAc,CAACO,YAAY,CAAG,EAAhB,CACZG,oBAAoB,CAAEkE,KAAK,CAACqK,MAAN,CAAavM,KADvB,CAEZjC,aAAa,CAAEL,IAFH,CAGZI,GAAG,CAAG,MAHM,CAAd,EAKA,KAAKI,YAAL,GApBJ,yBAqBU,MAAKC,aAAL,CAAmBT,IAAnB,CAAyB,CAAzB,CArBV,iE,mPAyBA,mBAAsBwE,KAAtB,qJACMxE,IADN,CACawE,KAAK,CAACqK,MAAN,CAAavM,KAAb,CAAmBmL,OAAnB,CAA2B,IAA3B,CAAiC,GAAjC,CADb,CAEE,GAAIzN,IAAI,EAAI,iBAAZ,CAA+BA,IAAI,CAAG,SAAP,CAA/B,IACK,IAAIA,IAAI,EAAI,KAAZ,CAAmBA,IAAI,CAAG,eAAP,CAH1B,KAKMA,IAAI,EAAI,MALd,4BAMM,KAAKJ,QAAL,CAAc,CAACO,YAAY,CAAG,CAAhB,CACZC,GAAG,CAAEoE,KAAK,CAACqK,MAAN,CAAavM,KADN,CAEZjC,aAAa,CAAGL,IAFJ,CAGZM,oBAAoB,CAAG,MAHX,CAAd,CAIG,iBAAM,OAAI,CAACC,cAAL,CAAoB,EAApB,CAAN,EAJH,EANN,gCAaI,KAAKX,QAAL,CAAc,CAACO,YAAY,CAAG,EAAhB,CACZC,GAAG,CAAGoE,KAAK,CAACqK,MAAN,CAAavM,KADP,CAEZjC,aAAa,CAAGL,IAFJ,CAGZM,oBAAoB,CAAG,MAHX,CAAd,EAKA,KAAKE,YAAL,GAlBJ,yBAmBU,MAAKC,aAAL,CAAmBT,IAAnB,CAnBV,iE,8IAyDA;AACA,6BAAoBwE,KAApB,CAA2B,kBACzB,KAAK5E,QAAL,CAAc,CAACO,YAAY,CAAEqE,KAAK,CAACqK,MAAN,CAAavM,KAA5B,CAAd,EACE,OAAQkC,KAAK,CAACqK,MAAN,CAAavM,KAArB,EACE,IAAK,IAAL,CACI,GAAInB,OAAM,CAAG,KAAK/B,KAAL,CAAW+B,MAAxB,CACAA,MAAM,CAAGA,MAAM,CAAC+L,KAAP,CAAa,CAAb,CAAgB,EAAhB,CAAT,CACA,KAAKtN,QAAL,CAAc,CAACuB,MAAM,CAAEA,MAAT,CAAd,EACA,KAAKZ,cAAL,CAAoBY,MAApB,EACA,MAEJ,IAAK,IAAL,CACI,GAAI,KAAK/B,KAAL,CAAW+B,MAAX,CAAkBxB,MAAlB,CAA2B,EAA/B,CAAmC,CACjC,KAAKuL,cAAL,CAAoB,EAApB,CAAwB,KAAxB,EACD,CAFD,IAEO,CACL,GAAI/J,OAAM,CAAG,KAAK/B,KAAL,CAAW+B,MAAxB,CACAA,MAAM,CAAGA,MAAM,CAAC+L,KAAP,CAAa,CAAb,CAAgB,EAAhB,CAAT,CACA,KAAKtN,QAAL,CAAc,CAACuB,MAAM,CAAEA,MAAT,CAAd,EACA,KAAKZ,cAAL,CAAoBY,MAApB,EACD,CACD,MAEJ,IAAK,IAAL,CACI,GAAI,KAAK/B,KAAL,CAAW+B,MAAX,CAAkBxB,MAAlB,CAA2B,EAA/B,CAAmC,CACjC,KAAKuL,cAAL,CAAoB,EAApB,CAAwB,IAAxB,CAA8B,UAAK,CACjC,OAAI,CAACA,cAAL,CAAoB,EAApB,CAAwB,KAAxB,EACD,CAFD,EAID,CALD,IAKO,IAAI,KAAKtK,KAAL,CAAWO,MAAX,CAAkBxB,MAAlB,EAA4B,EAAhC,CAAoC,CACzC,KAAKuL,cAAL,CAAoB,EAApB,CAAwB,KAAxB,EACD,CAFM,IAGF,CACH,GAAI/J,OAAM,CAAG,KAAK/B,KAAL,CAAW+B,MAAxB,CACAA,MAAM,CAAGA,MAAM,CAAC+L,KAAP,CAAa,CAAb,CAAgB,EAAhB,CAAT,CACA,KAAK3M,cAAL,CAAoBY,MAApB,EACD,CACD,MAjCN,CAmCH,C,8BAED,wBAAeyD,IAAf,CAAqB,kBACnB,GAAI,KAAKxF,KAAL,CAAWE,OAAX,CAAmBC,KAAnB,CAAyB0M,KAAzB,CAA+BC,QAA/B,CAAwC,eAAxC,CAAJ,CAA8D,CAAE;AAC9D,GAAI4C,YAAW,CAAG,CAAC,KAAKlO,KAAL,CAAW2N,YAAZ,CAAlB,CACA3J,IAAI,CAACnD,GAAL,CAAS,SAAAV,CAAC,CAAI,CACZ,GAAIA,CAAC,CAACvB,QAAF,GAAeE,SAAnB,CAA8B,OAC9B,GAAIqB,CAAC,CAACvB,QAAF,GAAe,OAAI,CAACoB,KAAL,CAAW2N,YAAX,CAAwB/O,QAA3C,CACEsP,WAAW,CAAC3J,IAAZ,CAAiBpE,CAAjB,EACH,CAJD,EAKA,KAAK3B,KAAL,CAAWmB,cAAX,CAA0BuO,WAA1B,EACD,CARD,IASE,MAAK1P,KAAL,CAAWmB,cAAX,CAA0BqE,IAA1B,EACH,C,mCAED,6BAAoBA,IAApB,CAA0B,CACxB,KAAKxF,KAAL,CAAWoD,mBAAX,CAA+BoC,IAA/B,EACD,C,6BACD,uBAAcA,IAAd,CAAoB,CAClB,KAAKxF,KAAL,CAAW2L,aAAX,CAAyBnG,IAAzB,EACD,C,8BACD,wBAAerF,KAAf,CAAsB,CACrB,MAAO9C,kBAAiB,CAACsS,KAAlB,CAAwB,IAAxB,CAA8B,CAACxP,KAAD,CAA9B,CAAP,CACA,C,iHAED,mfACUyP,SADV,CACyDjQ,QADzD,CACUiQ,SADV,CACqBC,QADrB,CACyDlQ,QADzD,CACqBkQ,QADrB,CAC+BC,MAD/B,CACyDnQ,QADzD,CAC+BmQ,MAD/B,CACuCC,KADvC,CACyDpQ,QADzD,CACuCoQ,KADvC,CAC8CC,MAD9C,CACyDrQ,QADzD,CAC8CqQ,MAD9C,yBAGuBtQ,UAAS,CAAC,KAAKM,KAAL,CAAWE,OAAX,CAAmBmJ,GAApB,CAHhC,QAGQ4G,MAHR,oBAISA,MAJT,4BAKQ;AACIC,eANZ,CAM8B,IAN9B,CAMmC;AACvBC,eAPZ,CAO8B,IAP9B,CAOmC;AACrBC,OARd,CAQwBnT,YAAY,CAACiT,eAAD,CAAkB,SAAlB,CAA6B,KAAK1O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CARpC,CAScmO,OATd,CASwBpT,YAAY,CAACkT,eAAD,CAAkB,SAAlB,CAA6B,KAAK3O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CATpC,CAUQ;AACIoO,MAXZ,CAWqB5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAX9B,CAYQ/E,mBAAmB,CAAC,SAAD,CAAYmT,MAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,MAAvC,CAA+CzE,YAA/C,CAA6D,GAAId,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAA7D,CAAnB,CACAD,MAAM,CAAG5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAAlB,CACA/E,mBAAmB,CAAC,SAAD,CAAYmT,MAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,MAAvC,CAA+CxE,UAA/C,CAA2D,GAAIf,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAA3D,CAAnB,CAEA;AACAD,MAAM,CAAG5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,MAApB,CAA4B,CAA5B,CAAlB,CACIsO,OAlBZ,CAkBsB,CAlBtB,CAmBYC,OAnBZ,CAmBsB,EAnBtB,CAoBYC,SApBZ,CAoBwB,MAAQD,OApBhC,CAoBwC;AAE1B,IAAS7O,CAAT,CAAW,CAAX,CAAcA,CAAC,EAAI6O,OAAnB,CAA4B7O,CAAC,EAA7B,CAAiC,CAC7B0O,MAAM,CAAGA,MAAM,CAACzB,MAAP,CAAcnS,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoBN,CAAC,CAAC8O,SAAtB,CAAiCF,OAAO,CAAC,CAAzC,CAAvB,CAAT,CACAA,OAAO,EAAE,CAAT,CACH,CAEP;AACAF,MAAM,CAAC5O,OAAP,CAAe,SAACC,CAAD,CAAIC,CAAJ,CAAU,CACjC;AACS,CAFD,EAII+O,SAhCZ,CAgCwBjU,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,CAApB,CAAuB,EAAvB,CAhCjC,CAiCQyO,SAAS,CAACjP,OAAV,CAAkB,SAACC,CAAD,CAAGC,CAAH,CAAS,CAClC;AACQ,CAFD,EAjCR,2CAwCI,GAAIqO,MAAM,GAAKL,SAAf,CAA0B,CACxB;AACIM,gBAFoB,CAEF,GAFE,CAEE;AACtBC,gBAHoB,CAGF,GAHE,CAGE;AACnBC,OAJiB,CAIPnT,YAAY,CAACiT,gBAAD,CAAkB,SAAlB,CAA6B,KAAK1O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CAJL,CAKjBmO,QALiB,CAKPpT,YAAY,CAACkT,gBAAD,CAAkB,SAAlB,CAA6B,KAAK3O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CALL,CAMxB;AACIoO,OAPoB,CAOX5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAPE,CAQxB/E,mBAAmB,CAAC,SAAD,CAAYmT,OAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,SAAvC,CAAkD1E,aAAlD,CAAiE,GAAIb,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAAjE,CAAnB,CACAD,OAAM,CAAG5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAAlB,CACA/E,mBAAmB,CAAC,SAAD,CAAYmT,OAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,QAAvC,CAAiD3E,WAAjD,CAA8D,GAAIZ,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAA9D,CAAnB,CAEA;AACIE,QAboB,CAaV,CAbU,CAcpBC,UAdoB,CAcR,KAAOD,QAdC,CAcO;AAC3BD,QAfoB,CAeV,CAfU,CAgBxB,IAAS5O,EAAT,CAAW,CAAX,CAAcA,EAAC,EAAI6O,QAAnB,CAA4B7O,EAAC,EAA7B,CAAiC,CAC7B0O,OAAM,CAAGA,OAAM,CAACzB,MAAP,CAAcnS,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoBN,EAAC,CAAC8O,UAAtB,CAAiCF,QAAO,CAAC,CAAzC,CAAvB,CAAT,CACAA,QAAO,EAAE,CAAT,CACH,CAEDF,OAAM,CAAC5O,OAAP,CAAe,SAACC,CAAD,CAAIC,CAAJ,CAAU,CAC/B;AACO,CAFD,EAII+O,UAzBoB,CAyBRjU,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,IAApB,CAA0B,EAA1B,CAzBD,CA0BxByO,UAAS,CAACjP,OAAV,CAAkB,SAACC,CAAD,CAAGC,CAAH,CAAS,CACjC;AACO,CAFD,EAID,CA9BD,IA8BQ,CACN;AACIsO,iBAFE,CAEgB,GAFhB,CAEqB;AACvBC,iBAHE,CAGiB,IAHjB,CAGsB;AACtBC,QAJA,CAIUnT,YAAY,CAACiT,iBAAD,CAAkB,SAAlB,CAA6B,KAAK1O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CAJtB,CAKAmO,QALA,CAKUpT,YAAY,CAACkT,iBAAD,CAAkB,SAAlB,CAA6B,KAAK3O,KAAL,CAAWa,GAAxC,CAA6C,KAAKb,KAAL,CAAWU,MAAxD,CALtB,CAMN;AACIoO,QAPE,CAOO5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAPhB,CAQN/E,mBAAmB,CAAC,SAAD,CAAYmT,QAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,QAAvC,CAAiD3E,WAAjD,CAA8D,GAAIZ,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAA9D,CAAnB,CACAD,QAAM,CAAG5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,CAA3B,CAAlB,CACA/E,mBAAmB,CAAC,SAAD,CAAYmT,QAAM,CAAC,CAAD,CAAlB,CAAuB,KAAK9O,KAAL,CAAWa,GAAlC,CAAuC,MAAvC,CAA+CzE,YAA/C,CAA6D,GAAId,OAAM,CAAC+C,IAAP,CAAY0Q,KAAhB,CAAsB,EAAtB,CAA0B,EAA1B,CAA7D,CAAnB,CAEA;AACAD,QAAM,CAAG5T,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,MAApB,CAA4B,CAA5B,CAAlB,CACIsO,SAdE,CAcQ,CAdR,CAeFC,SAfE,CAeQ,CAfR,CAgBFC,WAhBE,CAgBU,IAAKD,SAhBf,CAgBuB;AAC7B;AAEA,IAAS7O,GAAT,CAAW,CAAX,CAAcA,GAAC,EAAI6O,SAAnB,CAA4B7O,GAAC,EAA7B,CAAiC,CAC7B0O,QAAM,CAAGA,QAAM,CAACzB,MAAP,CAAcnS,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoBN,GAAC,CAAC8O,WAAtB,CAAiCF,SAAO,CAAC,CAAzC,CAAvB,CAAT,CACAA,SAAO,EAAE,CAAT,CACH,CAEDF,QAAM,CAAC5O,OAAP,CAAe,SAACC,CAAD,CAAIC,CAAJ,CAAU,CAC9B;AACM,CAFD,EAII+O,WA5BE,CA4BUjU,SAAS,CAAC,KAAK8E,KAAL,CAAWU,MAAZ,CAAoB,KAApB,CAA2B,EAA3B,CA5BnB,CA6BNyO,WAAS,CAACjP,OAAV,CAAkB,SAACC,CAAD,CAAGC,CAAH,CAAS,CAC5B;AACE,CAFD,EAGH,CAtGH,gE,0HA8GA,yBAAgBuE,MAAhB,CAAyB,CACvB,KAAK3F,QAAL,CAAc,CACV0B,MAAM,CAAEiE,MADE,CAAd,EAGH,CAEE;kCAsCH,4BAAmBxC,QAAnB,CAA6B,kBAE3B;AACA,GAAI,CAAC,KAAKnC,KAAL,CAAWwH,aAAX,CAAyBpG,GAAzB,CAA6B,KAAK5C,KAAL,CAAW4E,YAAX,CAAwBxE,QAArD,CAAL,CAAqE,CACnE,KAAKsD,eAAL,CAAqB,KAAKlC,KAAL,CAAWa,GAAhC,CAAqC,KAAKrC,KAAL,CAAW4E,YAAX,CAAwBxE,QAA7D,CAAuE,SAACgP,OAAD,CAAa,CAClF,OAAI,CAAC5N,KAAL,CAAWwH,aAAX,CAAyBhH,GAAzB,CAA6B,OAAI,CAAChC,KAAL,CAAW4E,YAAX,CAAwBxE,QAArD,CAA+DgP,OAA/D,EAEG;AACL,GAAI,CAAC,OAAI,CAAC5N,KAAL,CAAWyH,YAAX,CAAwBrG,GAAxB,CAA4B,OAAI,CAAC5C,KAAL,CAAW4E,YAAX,CAAwBxE,QAApD,CAAL,CAAoE,CAClE,GAAI,OAAI,CAACJ,KAAL,CAAW4E,YAAX,CAAwBgM,MAAxB,GAAmCtQ,SAAvC,CAAkD,CACjDrE,QAAQ,CAAC,OAAI,CAAC+D,KAAL,CAAW4E,YAAX,CAAwBgM,MAAxB,CAA+B,CAA/B,EAAkCC,eAAnC,CAAoD,GAApD,CAAyD,GAAzD,CAA8D,SAACrL,IAAD,CAAU,CAC/E,OAAI,CAAChE,KAAL,CAAWyH,YAAX,CAAwBjH,GAAxB,CAA4B,OAAI,CAAChC,KAAL,CAAW4E,YAAX,CAAwBxE,QAApD,CAA8DoF,IAAI,CAACgD,GAAnE,EACA7E,QAAQ,GACT,CAHQ,CAAR,CAIA,CALD,IAKO,CACLA,QAAQ,GACT,CACF,CACA,CAdD,EAeD,CAhBD,IAgBO,CACLA,QAAQ,GACT,CACF,C,sBAsKC,iBAAS,kBACP,GAAMmN,YAAW,CAAG,QAAdA,YAAc,CAACzO,GAAD,CAAMxC,IAAN,CAAYqC,MAAZ,CAAuB,CACzC,OAAI,CAACV,KAAL,CAAWa,GAAX,CAAiBA,GAAjB,CACJ;AACM,GAAI0O,mBAAkB,CAAG7T,YAAY,CAAC,eAAD,CAAkBgF,MAAlB,CAA0BG,GAA1B,CAA+B,eAA/B,CAAgD/E,WAAhD,CAArC,CACAyT,kBAAkB,CAACC,SAAnB,CAA6B,IAA7B,EACA,GAAMC,QAAO,CAAG,wBAAhB,CACL;AACOF,kBAAkB,CAAC5N,WAAnB,CAA+B,OAA/B,CAAwC,UAAM,CAC5CvD,UAAU,CAAC0D,UAAX,CAAsB2N,OAAtB,EACArR,UAAU,CAAC6D,IAAX,CAAgBpB,GAAhB,CAAqB0O,kBAArB,EACAnR,UAAU,CAACiC,MAAX,CAAoBkP,kBAApB,CACH,CAJC,EAKV;AACM,OAAI,CAAC1E,WAAL,GAEA,OAAI,CAAClF,eAAL,GACA,OAAI,CAAC4E,iBAAL,GACD;AACA,CAlBD,CAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEF,GAAMmF,WAAU,CAAG,QAAbA,WAAa,sBAEjB,aAAK,SAAS,CAAC,iBAAf,wBACE,aAAK,SAAS,CAAC,QAAf,wBACE,KAAC,MAAD,EAAQ,SAAS,CAAC,gBAAlB,CAAmC,OAAO,CAAE,OAAI,CAAClR,KAAL,CAAWsN,kBAAvD,eADF,cAEE,KAAC,MAAD,EAAQ,SAAS,CAAC,gBAAlB,CAAmC,OAAO,CAAC,OAA3C,CAAmD,OAAO,CAAE,OAAI,CAACrL,cAAjE,iBAFF,cAIE,aAAK,SAAS,CAAC,kBAAf,wBACI,gCADJ,cAEI,KAAC,YAAD,EAAc,OAAO,CAAE,OAAI,CAACT,KAAL,CAAWW,QAAlC,CAA4C,cAAc,CAAE,OAAI,CAAC+C,YAAjE,EAFJ,GAJF,cAQE,aAAK,SAAS,CAAC,kBAAf,wBACE,iCADF,cAEE,KAAC,YAAD,EAAc,OAAO,CAAE,IAAvB,CAA6B,cAAc,CAAE,OAAI,CAACJ,YAAlD,EAFF,GARF,GADF,cAcI,aAAK,SAAS,CAAC,0BAAf,wBACE,oCACE,2CADF,cAEE,MAAC,IAAD,CAAM,OAAN,EAAc,KAAK,CAAE,OAAI,CAACtD,KAAL,CAAWN,oBAAhC,CAAsD,EAAE,CAAC,QAAzD,CAAkE,IAAI,CAAC,eAAvE,CAAuF,QAAQ,CAAE,OAAI,CAACgL,oBAAtG,wBACc,gCADd,cAEc,+BAFd,CAGanP,cAAc,CAACsF,GAAf,CAAmB,SAACV,CAAD,CAAIC,CAAJ,CAAU,CAC5B,GAAID,CAAC,EAAI,aAAT,CAAwB,CACpB,mBAAO,wBAAkBA,CAAC,CAAC0M,OAAF,CAAU,IAAV,CAAgB,GAAhB,CAAlB,EAAczM,CAAd,CAAP,CACH,CACF,CAJA,CAHb,GAFF,GADF,cAaE,oCACE,4CADF,cAEE,MAAC,IAAD,CAAM,OAAN,EAAc,KAAK,CAAE,OAAI,CAACJ,KAAL,CAAWR,GAAhC,CAAqC,EAAE,CAAC,QAAxC,CAAiD,IAAI,CAAC,KAAtD,CAA4D,QAAQ,CAAE,OAAI,CAACyL,eAA3E,wBACY,gCADZ,cAEY,+BAFZ,CAGazP,SAAS,CAACqF,GAAV,CAAc,SAACV,CAAD,CAAIC,CAAJ,CAAU,CACvB,mBAAO,wBAAiBD,CAAC,CAAC0M,OAAF,CAAU,IAAV,CAAgB,GAAhB,CAAjB,EAAazM,CAAb,CAAP,CACD,CAFA,CAHb,GAFF,GAbF,GAdJ,GAFiB,EAAnB,CA2CE;AACA,GAAIuP,oBAAmB,cAAG,kBAA1B,CACA,GAAMpI,WAAU,cAAI,KAAC,eAAD,EACpB,GAAG,CAAE,KAAKA,UADU,CAEpB,MAAM,CAAElM,UAFY,CAGpB,yBAAyB,CAAE,CACzB6K,QAAQ,CAAE,CAACtB,GAAG,CAAE,KAAKpG,KAAL,CAAWkC,MAAX,CAAkBkE,GAAxB,CAA6BC,GAAG,CAAE,KAAKrG,KAAL,CAAWkC,MAAX,CAAkBmE,GAApD,CADe,CAEzB+K,GAAG,CAAE,CAACpJ,OAAO,CAAE,KAAKxG,KAAL,CAAWwG,OAArB,CAA8BM,KAAK,CAAE,CAArC,CAFoB,CAGzBqB,IAAI,CAAE,CAHmB,CAIzB0H,MAAM,CAAEvU,MAAM,CAAC+C,IAAP,CAAYyR,gBAAZ,CAA6BC,OAJZ,CAHP,CASpB,KAAK,CAAE,OATa,CAUpB,MAAM,CAAE,OAVY,EAApB,CAaA,GAAI,KAAK/P,KAAL,CAAWwG,OAAX,EAAsB1H,SAA1B,CAAqC,CACnC6Q,mBAAmB,CAAGpI,UAAtB,CACH,CAED,GAAMyI,UAAS,cAAG,aAAK,SAAS,CAAC,qBAAf,wBACZ,KAAC,cAAD,EACE,GAAG,CAAE,KAAK3I,KADZ,CAEI,gBAAgB,CAAE,CAAE5F,GAAG,CAAEpG,UAAP,CAFtB,CAGI,MAAM,CAAE,KAAK2E,KAAL,CAAWU,MAHvB,CAII,IAAI,CAAE,KAAKV,KAAL,CAAWmI,IAJrB,CAKI,kCAAkC,CAAE,IALxC,CAMI,UAAU,CAAE,CAAC,cAAD,CAAiB,cAAjB,CANhB,CAOI,EAAE,CAAE,KAPR,CAQI,iBAAiB,CAAE,sCAAGtH,IAAH,QAAGA,GAAH,CAAQxC,IAAR,QAAQA,IAAR,OAAmBiR,YAAW,CAACzO,GAAD,CAAMxC,IAAN,CAAY,OAAI,CAAC2B,KAAL,CAAWU,MAAvB,CAA9B,EARvB,CASI,OAAO,CAAG,KAAKV,KAAL,CAAWwI,UATzB,CAUI,mBAAmB,CAAI,IAV3B,CAWI,QAAQ,CAAE,KAAK7E,YAXnB,EADY,CAcX,KAAK3D,KAAL,CAAWW,QAAX,eACD,YAAK,SAAS,CAAC,sBAAf,UACGgP,mBADH,EAfY,CAkBX,KAAK3P,KAAL,CAAWuI,WAAX,CAAuB,KAAK/J,KAAL,CAAWiO,UAAlC,GAAiD,IAAjD,eACC,aAAK,SAAS,CAAC,gBAAf,wBACE,KAAC,UAAD,EAAY,KAAK,CAAC,SAAlB,CAA4B,IAAI,CAAE,EAAlC,EADF,cAEE,yCAFF,GAnBU,GAAlB,CA0BE,mBACE,aAAK,SAAS,CAAC,eAAf,wBAEE,KAAC,UAAD,EAAY,cAAc,CAAE,GAA5B,uBAAiC,KAAC,UAAD,IAAjC,EAFF,cAGE,MAAC,UAAD,EAAY,cAAc,CAAE,GAA5B,wBACE,KAAC,OAAD,EAAS,WAAW,CAAE,KAAKtF,WAA3B,EADF,CAEG,KAAKnH,KAAL,CAAWoH,SAAX,eAAwB,KAAC,UAAD,IAF3B,GAHF,CAQK,KAAKpH,KAAL,CAAWf,UAAX,eACC,eAAQ,SAAS,CAAC,eAAlB,CAAkC,OAAO,CAAE,KAAK8H,iBAAhD,uBACE,oCACE,aAAM,KAAK,CAAE,CAAEkJ,KAAK,CAAE,OAAT,CAAb,iDADF,kBAC6E,aAAM,KAAK,CAAE,CAAEA,KAAK,CAAG,MAAV,CAAb,kBAD7E,kBACyH,aAAM,KAAK,CAAE,CAAEA,KAAK,CAAE,OAAT,CAAb,0BADzH,GADF,EATN,cAgBG,MAAC,UAAD,EAAY,cAAc,CAAE,GAA5B,WACI,KAAKjQ,KAAL,CAAWf,UAAX,eAA0B,YAAK,KAAK,CAAE,CAACiR,MAAM,CAAE3E,MAAM,CAAC4E,WAAP,CAAqB,EAArB,CAA0B,EAAnC,CAAZ,UACpBH,SADoB,EAD9B,CAKI,CAAC,KAAKhQ,KAAL,CAAWf,UAAZ,eAA2B,YAAK,KAAK,CAAE,CAACiR,MAAM,CAAE3E,MAAM,CAAC4E,WAAP,CAAqB,EAA9B,CAAZ,UACvBH,SADuB,EAL/B,GAhBH,cA2BG,KAAC,UAAD,EAAY,cAAc,CAAE,GAA5B,uBACG,YAAK,KAAK,CAAE,CAACE,MAAM,CAAI,KAAKlQ,KAAL,CAAWf,UAAZ,gBAAkC,KAAKT,KAAL,CAAW0R,MAA7C,aAAgE,KAAK1R,KAAL,CAAW0R,MAArF,CAAZ,UACGF,SADH,EADH,EA3BH,cAiCE,MAAC,UAAD,EAAY,cAAc,CAAE,GAA5B,wBAEE,KAAC,iBAAD,EACG,aAAa,CAAE,KAAKxR,KAAL,CAAWiB,aAD7B,CAEG,MAAM,CAAI,KAAKjB,KAAL,CAAWE,OAAX,CAAmBiJ,MAFhC,CAGG,IAAI,CAAI,KAAKnJ,KAAL,CAAWE,OAAX,CAAmBkJ,IAH9B,CAIG,KAAK,CAAI,KAAKpJ,KAAL,CAAWE,OAAX,CAAmBsB,KAJ/B,CAKG,GAAG,CAAI,KAAKxB,KAAL,CAAWE,OAAX,CAAmBmJ,GAL7B,CAMG,GAAG,CAAI,KAAKrJ,KAAL,CAAWE,OAAX,CAAmBiG,MAAnB,CAA0BC,GANpC,CAOG,GAAG,CAAI,KAAKpG,KAAL,CAAWE,OAAX,CAAmBiG,MAAnB,CAA0BE,GAPpC,CAQG,UAAU,CAAE,KAAKuL,UARpB,CASG,WAAW,CAAI,6BATlB,EAFF,cAcG,KAAC,UAAD,IAdH,cAeG,KAAC,WAAD,IAfH,cAgBE,YAAK,SAAS,CAAC,iBAAf,uBACE,KAAC,mBAAD,IADF,EAhBF,GAjCF,GADF,CAyDD,C,uBAzjCqB/V,S,EAAlBkE,S,CACG8R,Y,CAAe,CACpBC,aAAa,CAAE,CACb1L,GAAG,CAAE,KADQ,CAEbC,GAAG,CAAE,KAFQ,CADK,CAKpB0L,WAAW,CAAE,EALO,C,CA4jCxB,GAAMC,gBAAe,CAAG7V,cAAc,CACpC+B,cADoC,CAEpCJ,cAFoC,CAGpCC,eAHoC,CAIpCC,oBAJoC,CAKpCK,WALoC,CAMpCF,aANoC,CAOpCC,aAPoC,CAQpCH,iBARoC,CASpCK,cAToC,CAUpCC,uBAVoC,CAWpCC,sBAXoC,CAYpCC,eAZoC,CAapCC,aAboC,CAcpC,SAACqD,MAAD,CAAS6C,YAAT,CAAuB1E,OAAvB,CAAgCe,aAAhC,CAA+CoI,GAA/C,CAAoD7H,KAApD,CAA2DyQ,KAA3D,CAAkEhE,UAAlE,CAA8EiE,MAA9E,CAAsF1D,gBAAtF,CAAwGlJ,cAAxG,CAAwH6M,QAAxH,CAAkI7D,KAAlI,QAA6I,CAC3IvM,MAAM,CAANA,MAD2I,CAE3I6C,YAAY,CAAZA,YAF2I,CAG3I1E,OAAO,CAAPA,OAH2I,CAI3Ie,aAAa,CAAbA,aAJ2I,CAK3IoI,GAAG,CAAHA,GAL2I,CAM3I7H,KAAK,CAALA,KAN2I,CAO3IyQ,KAAK,CAALA,KAP2I,CAQ3IhE,UAAU,CAAVA,UAR2I,CAS3IiE,MAAM,CAANA,MAT2I,CAU3I1D,gBAAgB,CAAhBA,gBAV2I,CAW3IlJ,cAAc,CAAdA,cAX2I,CAY3I6M,QAAQ,CAARA,QAZ2I,CAa3I7D,KAAK,CAALA,KAb2I,CAA7I,EAdoC,CAAtC,CA+BA,GAAM8D,kBAAiB,CAAG,CACxBjR,cAAc,CAAE/E,YADQ,CAExBgH,mBAAmB,CAAE/G,iBAFG,CAGxBsP,aAAa,CAAEnP,WAHS,CAIxB+P,uBAAuB,CAAE1N,qBAJD,CAKxBwG,sBAAsB,CAAEtG,oBALA,CAA1B,CAQA,cAAeK,WAAU,CAAClD,OAAO,CAAC8V,eAAD,CAAkBI,iBAAlB,CAAP,CAA6CrS,SAA7C,CAAD,CAAzB,CAGA,QAASmG,SAAT,CAAkBmM,IAAlB,CAAwBC,IAAxB,CAA8BC,IAA9B,CAAoCC,IAApC,CAA0CC,IAA1C,CAAgD,CAC/C,GAAKJ,IAAI,EAAIE,IAAT,EAAmBD,IAAI,EAAIE,IAA/B,CAAsC,CACrC,MAAO,EAAP,CACA,CAFD,IAGK,CACJ,GAAIE,QAAO,CAAGC,IAAI,CAACC,EAAL,CAAUP,IAAV,CAAe,GAA7B,CACA,GAAIQ,QAAO,CAAGF,IAAI,CAACC,EAAL,CAAUL,IAAV,CAAe,GAA7B,CACA,GAAIO,MAAK,CAAGR,IAAI,CAACE,IAAjB,CACA,GAAIO,SAAQ,CAAGJ,IAAI,CAACC,EAAL,CAAUE,KAAV,CAAgB,GAA/B,CACA,GAAI7M,KAAI,CAAG0M,IAAI,CAACK,GAAL,CAASN,OAAT,EAAoBC,IAAI,CAACK,GAAL,CAASH,OAAT,CAApB,CAAwCF,IAAI,CAACM,GAAL,CAASP,OAAT,EAAoBC,IAAI,CAACM,GAAL,CAASJ,OAAT,CAApB,CAAwCF,IAAI,CAACM,GAAL,CAASF,QAAT,CAA3F,CACA,GAAI9M,IAAI,CAAG,CAAX,CAAc,CACbA,IAAI,CAAG,CAAP,CACA,CACDA,IAAI,CAAG0M,IAAI,CAACO,IAAL,CAAUjN,IAAV,CAAP,CACAA,IAAI,CAAGA,IAAI,CAAG,GAAP,CAAW0M,IAAI,CAACC,EAAvB,CACA3M,IAAI,CAAGA,IAAI,CAAG,EAAP,CAAY,MAAnB,CACA,GAAIwM,IAAI,EAAE,GAAV,CAAe,CAAExM,IAAI,CAAGA,IAAI,CAAG,QAAd,CAAwB,CACzC,GAAIwM,IAAI,EAAE,GAAV,CAAe,CAAExM,IAAI,CAAGA,IAAI,CAAG,MAAd,CAAsB,CACvC,MAAOA,KAAP,CACA,CACD"},"metadata":{},"sourceType":"module"}