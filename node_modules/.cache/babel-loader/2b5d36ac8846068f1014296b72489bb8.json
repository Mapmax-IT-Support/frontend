{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/sumanthvarma/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import Button from\"react-bootstrap/Button\";import Form from\"react-bootstrap/Form\";import FormGroup from\"react-bootstrap/FormGroup\";import FormControl from\"react-bootstrap/FormControl\";import FormLabel from\"react-bootstrap/FormLabel\";import{loginUser}from'../../Requests/users-requests';import*as selectors from'../../Reducers/selectors';import{updateUser}from'../../Actions/user-actions';import{connect}from'react-redux';import{createSelector}from'reselect';import{Link,withRouter}from'react-router-dom';import{getUserInfo}from'../../Requests/users-requests';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Login=/*#__PURE__*/function(_React$Component){_inherits(Login,_React$Component);var _super=_createSuper(Login);function Login(props){var _this;_classCallCheck(this,Login);_this=_super.call(this,props);_this.onFormChange=function(e){var update=_objectSpread({},_this.state[e.target.name]);update.value=e.target.value;update.target=e.target;// reset custom validation on change \nif(update.message.length>1){update.target.setCustomValidity('');update.message='';}// reset password error on email change\nif(e.target.name=='email'){if(_this.state.password.message.length>0){_this.state.password.target.setCustomValidity('');_this.setState({password:_objectSpread(_objectSpread({},_this.state.password),{},{message:''})});}}_this.setState(_defineProperty({},e.target.name,update));};_this.onUpdateUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(user){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:localStorage.clear();// fetch user info and set searches in local storage\nif(user.recentSearches!=undefined)localStorage.setItem('recentSearches',JSON.stringify(user.recentSearches));localStorage.setItem('user',JSON.stringify(user));_this.props.onUpdateUser(user);case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(event){var form,isValid,results;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:form=event.currentTarget;isValid=true;event.preventDefault();event.stopPropagation();if(!(form.checkValidity()===true)){_context2.next=28;break;}_context2.next=7;return loginUser(_this.state.email.value,_this.state.password.value);case 7:results=_context2.sent;if(!(results.error!=undefined)){_context2.next=22;break;}_context2.t0=results.error;_context2.next=_context2.t0==='Email not found'?12:_context2.t0==='Password not found'?15:18;break;case 12:if(_this.state.email.target!=undefined){_this.state.email.target.setCustomValidity('Username not found');}_this.setState({email:_objectSpread(_objectSpread({},_this.state.email),{},{message:'Username not found'})});return _context2.abrupt(\"break\",19);case 15:if(_this.state.password.target!=undefined){_this.state.password.target.setCustomValidity('Password not found');}_this.setState({password:_objectSpread(_objectSpread({},_this.state.password),{},{message:'Password not found'})});return _context2.abrupt(\"break\",19);case 18:return _context2.abrupt(\"break\",19);case 19:_this.setState({validated:true});_context2.next=26;break;case 22:if(!(results.length>0)){_context2.next=26;break;}_context2.next=25;return _this.onUpdateUser(results[0]);case 25:_this.props.history.push('/');case 26:_context2.next=29;break;case 28:_this.setState({validated:true});case 29:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.state={email:{value:'',isValid:true,message:'',target:''},password:{value:'',isValid:true,message:'',target:''},validated:false};return _this;}_createClass(Login,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{className:\"loginPage\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Login\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loginFormContainer\",children:/*#__PURE__*/_jsxs(Form,{noValidate:true,validated:this.state.validated,onSubmit:this.handleSubmit,children:[/*#__PURE__*/_jsx(Form.Row,{children:/*#__PURE__*/_jsxs(Form.Group,{controlId:\"formBasicEmail\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"formLabels\",children:\"Email\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"email\",placeholder:\"Enter email\",autoFocus:true,required:true,name:\"email\",value:this.state.email.value,onChange:this.onFormChange}),/*#__PURE__*/_jsx(Form.Text,{className:\"text-muted\"}),/*#__PURE__*/_jsx(\"span\",{type:\"invalid\",className:\"errorText\",children:this.state.email.message})]})}),/*#__PURE__*/_jsx(Form.Row,{children:/*#__PURE__*/_jsxs(Form.Group,{controlId:\"formBasicPassword\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"formLabels\",children:\"Password\"}),/*#__PURE__*/_jsx(Form.Control,{name:\"password\",required:true,value:this.state.password.value,type:\"password\",placeholder:\"Password\",onChange:this.onFormChange}),/*#__PURE__*/_jsx(\"span\",{type:\"invalid\",className:\"errorText\",children:this.state.password.message})]})}),/*#__PURE__*/_jsx(Form.Row,{className:\"submitContainer\",children:/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Submit\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"bottomText\",children:\"New User? \\xA0\"}),/*#__PURE__*/_jsx(Link,{className:\"bottomLink\",to:\"/register\",children:\"Create an Account\"})]})})]});}}]);return Login;}(React.Component);var mapStateToProps=createSelector(selectors.userSelector,function(user){return{user:user};});var mapActionsToProps={onUpdateUser:updateUser};export default withRouter(connect(mapStateToProps,mapActionsToProps)(Login));","map":{"version":3,"names":["React","Button","Form","FormGroup","FormControl","FormLabel","loginUser","selectors","updateUser","connect","createSelector","Link","withRouter","getUserInfo","Login","props","onFormChange","e","update","state","target","name","value","message","length","setCustomValidity","password","setState","onUpdateUser","user","localStorage","clear","recentSearches","undefined","setItem","JSON","stringify","handleSubmit","event","form","currentTarget","isValid","preventDefault","stopPropagation","checkValidity","email","results","error","validated","history","push","Component","mapStateToProps","userSelector","mapActionsToProps"],"sources":["/Users/sumanthvarma/Desktop/frontend/src/Components/Login/index.js"],"sourcesContent":["import React from 'react';\nimport Button from \"react-bootstrap/Button\";\nimport Form from \"react-bootstrap/Form\"\nimport FormGroup from \"react-bootstrap/FormGroup\";\nimport FormControl from \"react-bootstrap/FormControl\"\nimport FormLabel from \"react-bootstrap/FormLabel\"\nimport { loginUser } from '../../Requests/users-requests'\nimport * as selectors from '../../Reducers/selectors'\nimport { updateUser } from '../../Actions/user-actions';\nimport { connect } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport { Link, withRouter } from 'react-router-dom'\nimport { getUserInfo } from '../../Requests/users-requests'\n\n\nclass Login extends React.Component {\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            email: { value: '', isValid: true, message: '', target: '' },\n            password: { value: '', isValid: true, message: '', target: '' },\n            validated: false\n        \n        };\n    }\n\n    onFormChange = (e) => {\n        let update = { ...this.state[e.target.name]}\n\n        update.value = e.target.value\n        update.target = e.target\n\n        // reset custom validation on change \n        if (update.message.length > 1) {\n            update.target.setCustomValidity('')\n            update.message = ''\n        }\n\n        // reset password error on email change\n        if (e.target.name == 'email') {\n            if (this.state.password.message.length > 0) {\n                this.state.password.target.setCustomValidity('')\n                this.setState({ password : {...this.state.password, message : ''}})\n            }\n        }\n\n        this.setState({[e.target.name]: update})\n    }\n\n    onUpdateUser = async (user) => {\n        localStorage.clear()\n       \n        // fetch user info and set searches in local storage\n        if (user.recentSearches != undefined)\n            localStorage.setItem('recentSearches', JSON.stringify(user.recentSearches))\n        localStorage.setItem('user', JSON.stringify(user))\n        this.props.onUpdateUser(user)\n    }\n\n\n    handleSubmit = async (event) => {\n        const form = event.currentTarget;\n        let isValid = true;\n       \n       \n        event.preventDefault();\n        event.stopPropagation();\n\n        if (form.checkValidity() === true) {\n\n                 // stop default for failed custom validation\n                let results = await loginUser(this.state.email.value, this.state.password.value)\n                \n                if (results.error != undefined) {\n                    switch (results.error) {\n                        case 'Email not found': \n                            if (this.state.email.target != undefined) {\n                                this.state.email.target.setCustomValidity('Username not found')\n                            }\n                            this.setState({ email: {...this.state.email, message: 'Username not found' }})\n                            break;\n                        \n                        case 'Password not found': \n                            if (this.state.password.target != undefined) {\n                                this.state.password.target.setCustomValidity('Password not found')\n                            }\n                            this.setState({ password: {...this.state.password, message: 'Password not found' }})\n                            break;\n\n                        default: break;\n                    }\n                    this.setState({validated: true});\n                } else {\n                if (results.length > 0) {\n                    await this.onUpdateUser(results[0])\n                    this.props.history.push('/')\n                }\n            }\n        } else this.setState({ validated : true})\n    }\n\n    render() {\n \n        return (\n            <div className=\"loginPage\">\n                <h1>Login</h1>\n            <div className=\"loginFormContainer\">\n               <Form noValidate validated={this.state.validated} onSubmit={this.handleSubmit}>\n               <Form.Row>\n                    <Form.Group controlId=\"formBasicEmail\" >\n                        <Form.Label className=\"formLabels\">Email</Form.Label>\n                        <Form.Control \n                            type=\"email\" \n                            placeholder=\"Enter email\" \n                            autoFocus\n                            required\n                            name=\"email\"\n                            value={this.state.email.value}\n                            onChange={this.onFormChange}\n                        />\n                        <Form.Text className=\"text-muted\">\n                        </Form.Text>\n                            <span type=\"invalid\" className=\"errorText\">\n                                {this.state.email.message}\n                            </span>\n                    </Form.Group>\n                </Form.Row>\n                <Form.Row>\n                    <Form.Group controlId=\"formBasicPassword\">\n                        <Form.Label className=\"formLabels\">Password</Form.Label>\n                        <Form.Control \n                            name=\"password\"\n                            required\n                            value={this.state.password.value}\n                            type=\"password\" \n                            placeholder=\"Password\" \n                            onChange={this.onFormChange}/>\n                            <span type=\"invalid\" className=\"errorText\">\n                                {this.state.password.message}\n                            </span>\n                    </Form.Group>\n                </Form.Row>\n                \n                <Form.Row className=\"submitContainer\">\n                    <Button variant=\"primary\" type=\"submit\">Submit</Button>\n                </Form.Row>\n                <span className=\"bottomText\">New User?\t&nbsp;</span>\n                <Link className=\"bottomLink\" to=\"/register\">Create an Account</Link> \n            </Form>\n            </div>\n          \n            </div>\n        );\n    }\n}\n\n\nconst mapStateToProps = createSelector(\n    selectors.userSelector,\n    (user) => ({\n        user\n    })\n)\n\nconst mapActionsToProps = {\n    onUpdateUser: updateUser\n};\n\nexport default withRouter(connect(mapStateToProps, mapActionsToProps)(Login));\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}